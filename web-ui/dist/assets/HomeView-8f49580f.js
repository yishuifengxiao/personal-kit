import{f as s,A as R,d as Q,r as w,i as W,m as X,a as Y,D as Z,o as h,g as v,w as r,F as O,u as D,b as a,e as l,j as K,c as V,h as d,t as i}from"./index-8cadae33.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";import{U as ee}from"./UserOutlined-839a9000.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"};const se=te;function $(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},u=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(o).filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable}))),u.forEach(function(c){re(e,c,o[c])})}return e}function re(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var P=function(t,o){var u=$({},t,o.attrs);return s(R,$({},u,{icon:se}),null)};P.displayName="LogoutOutlined";P.inheritAttrs=!1;const oe=P;var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"};const ae=ne;function N(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?Object(arguments[t]):{},u=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(o).filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable}))),u.forEach(function(c){le(e,c,o[c])})}return e}function le(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var M=function(t,o){var u=N({},t,o.attrs);return s(R,N({},u,{icon:ae}),null)};M.displayName="VerticalRightOutlined";M.inheritAttrs=!1;const ie=M;const ue=Q({data(){const e=w({}),t=w({leftMenus:[],topMenus:[]});return{user:e,menu:t,selectedTopKeys:"knowledge_graph",selectedLeftKeys:"",openKeys:"",userDetailVisible:!1,userDetail:{},passwordModalVisible:!1,passwordLoading:!1,passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},passwordRules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"新密码长度至少6位",trigger:"blur"},{validator:(L,p,m)=>{p===this.passwordForm.currentPassword?m(new Error("新密码不能与当前密码相同")):m()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(L,p,m)=>{p!==this.passwordForm.newPassword?m(new Error("两次输入的密码不一致")):m()},trigger:"blur"}]}}},computed:{...W(D,["currentUserId","currentRoleId","currentTopMenuId","currentLeftMenuId"]),breadcrumbName:function(){var t;return((t=this.$route.meta)==null?void 0:t.breadcrumbName)||[]},selectedTopKeysSource:{get(){return this.currentTopMenuId.length>0?[this.currentTopMenuId]:this.selectedTopKeys.length>0?[this.selectedTopKeys]:[this.menu.topMenus[0].routerName]},set(e){this.selectedTopKeys=e}},leftMenuSource:function(){return this.menu.leftMenus.map(e=>{const t={key:e.routerName,label:e.name,title:e.name};return typeof e.childrens<"u"&&e.childrens.length>0&&(t.children=e.childrens.map(o=>({key:o.routerName,label:o.name,title:o.name}))),t})},selectedLeftKeysSource:{get(){if(this.selectedLeftKeys.length>0)return[this.selectedLeftKeys];if(this.currentLeftMenuId.length>0)return[this.currentLeftMenuId];const e=this.menu.leftMenus[0];return typeof e>"u"?[]:typeof e.childrens<"u"&&e.childrens.length>0?[e.childrens[0].routerName]:[e.routerName]},set(e){this.selectedLeftKeys=e}},openKeysSource:{get(){return this.openKeys.length>0?[this.openKeys]:this.menu.leftMenus.filter(e=>typeof e.childrens<"u"&&e.childrens.length>0).map(e=>e.routerName)},set(e){this.openKeys=e}}},methods:{...X(D,["setRole","setUser","setTopMenuId","setLeftMenuId","clearUser"]),async loadUserInfo(){this.$http.request({url:"/personkit/current",method:"get"}).then(e=>{if(this.user=w(e),this.setUser(e),!(e.roles.length>1)){const t=e.roles[0];this.setRole(t)}this.findRoleMenu()}).catch(e=>console.log(e))},findRoleMenu(){return new Promise((e,t)=>{this.$http.request({url:"/personkit/sys/menu/findRoleMenu",method:"post",data:{roleId:this.currentRoleId,topMenuId:this.currentTopMenuId}}).then(o=>{this.menu=w(o),e(o)}).catch(o=>{console.log(o),t(o)})})},async onTopMenuSelect({item:e,key:t}){this.setTopMenuId(e.id),this.selectedTopKeys=Y([t]),await this.findRoleMenu(),await this.autoSelectFirstLeftMenu()},async autoSelectFirstLeftMenu(){if(this.menu.leftMenus&&this.menu.leftMenus.length>0){const e=this.menu.leftMenus[0];let t="";if(e.childrens&&e.childrens.length>0?t=e.childrens[0].routerName:t=e.routerName,t){this.selectedLeftKeys=t,this.setLeftMenuId(t);try{this.$router.resolve({name:t}).matched.length>0?await this.$router.replace({name:t}):await this.$router.replace({name:"data_source_management"})}catch{console.warn(`路由 ${t} 不存在，跳转到默认路由`),await this.$router.replace({name:"data_source_management"})}this.$forceUpdate()}}},onLeftMenuSelect({key:e}){this.selectedLeftKeys=e,this.setLeftMenuId(e),this.$router.push({name:e})},exit(){this.$router.push({name:"login"})},formatDate(e){return e?new Date(e).toLocaleString("zh-CN"):"-"},getStatusName(e){return{1:"正常",2:"禁用",3:"锁定"}[e]||"未知状态"},getStatusBadge(e){return{1:"success",2:"error",3:"warning"}[e]||"default"},handleDropdownVisible(e){console.log("Dropdown open:",e)},showUserProfile(){this.userDetailVisible=!0,!this.userDetail.id&&this.user.id&&(this.userDetail={...this.user})},showPasswordModal(){this.passwordModalVisible=!0,this.resetPasswordForm()},closePasswordModal(){this.passwordModalVisible=!1,this.resetPasswordForm()},resetPasswordForm(){this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""},this.$refs.passwordFormRef&&this.$refs.passwordFormRef.clearValidate()},handlePasswordSubmit(){this.$refs.passwordFormRef.validate().then(()=>{this.passwordLoading=!0;const e={currentPassword:this.passwordForm.currentPassword,newPassword:this.passwordForm.newPassword};this.$http.request({url:"/personkit/sys/user/updatePassword",method:"post",data:e}).then(t=>{this.$message.success("密码修改成功，请重新登录"),this.closePasswordModal(),setTimeout(()=>{this.handleLogout()},1500)}).catch(t=>{console.error("修改密码失败:",t),this.$message.error(t.message||"密码修改失败")}).finally(()=>{this.passwordLoading=!1})}).catch(e=>{console.error("表单验证失败:",e)})},handleLogout(){this.$confirm({title:"确认退出",content:"确定要退出登录吗？",onOk:async()=>{try{this.clearUser(),localStorage.clear(),sessionStorage.clear(),this.$message.success("已退出登录"),setTimeout(()=>{window.location.href="/"},500)}catch(e){console.error("退出登录失败:",e),window.location.href="/"}},onCancel(){console.log("取消退出")}})}},updated(){this.loadUserInfo()},created(){this.loadUserInfo()},components:{UserOutlined:ee,DownOutlined:Z,VerticalRightOutlined:ie,LogoutOutlined:oe}}),de={class:"top-menu-container"},ce={class:"user-info-container"},me={class:"user-nickname"},pe={class:"user-dropdown-menu"},fe={class:"user-info-header"},he={class:"user-info-text"},ge={class:"user-name"},we={class:"user-role"},be={class:"main-container"},ye={class:"content-wrapper"},_e={class:"content-area"},ve={class:"user-detail-content"},Oe={class:"user-detail-header"},Pe={class:"user-detail-info"},Me={class:"detail-nickname"},Le={class:"detail-username"};function Se(e,t,o,u,c,L){const p=a("a-menu-item"),m=a("a-menu"),g=a("UserOutlined"),b=a("a-avatar"),k=a("a-divider"),F=a("VerticalRightOutlined"),U=a("LogoutOutlined"),I=a("DownOutlined"),T=a("a-button"),C=a("a-dropdown"),z=a("a-layout-header"),B=a("a-layout-sider"),j=a("a-breadcrumb-item"),q=a("a-breadcrumb"),A=a("RouterView"),E=a("a-layout"),f=a("a-descriptions-item"),H=a("a-badge"),G=a("a-descriptions"),S=a("a-modal"),y=a("a-input-password"),_=a("a-form-item"),J=a("a-form");return h(),v(O,null,[s(E,{class:"root_view"},{default:r(()=>[s(z,{class:"header"},{default:r(()=>[t[13]||(t[13]=l("div",{class:"logo-container"},[l("div",{class:"logo"},"PersonKit")],-1)),l("div",de,[s(m,{selectedKeys:e.selectedTopKeysSource,"onUpdate:selectedKeys":t[0]||(t[0]=n=>e.selectedTopKeysSource=n),theme:"dark",mode:"horizontal",onSelect:e.onTopMenuSelect,class:"top-menu"},{default:r(()=>[(h(!0),v(O,null,K(e.menu.topMenus,n=>(h(),V(p,{key:n.routerName,id:n.id},{default:r(()=>[d(i(n.name),1)]),_:2},1032,["id"]))),128))]),_:1},8,["selectedKeys","onSelect"])]),l("div",ce,[l("span",me,i(e.user.nickname),1),s(C,{onOpenChange:e.handleDropdownVisible},{overlay:r(()=>[l("div",pe,[l("div",fe,[s(b,{size:"large",class:"user-avatar"},{icon:r(()=>[s(g)]),_:1}),l("div",he,[l("div",ge,i(e.user.nickname),1),l("div",we,i(e.user.roleName||"普通用户"),1)])]),s(k,{style:{margin:"8px 0"}}),s(m,null,{default:r(()=>[s(p,{key:"profile",onClick:e.showUserProfile},{icon:r(()=>[s(g)]),default:r(()=>[t[10]||(t[10]=d(" 基本信息 ",-1))]),_:1},8,["onClick"]),s(p,{key:"password",onClick:e.showPasswordModal},{icon:r(()=>[s(F)]),default:r(()=>[t[11]||(t[11]=d(" 修改密码 ",-1))]),_:1},8,["onClick"]),s(p,{key:"logout",onClick:e.handleLogout},{icon:r(()=>[s(U)]),default:r(()=>[t[12]||(t[12]=d(" 退出登录 ",-1))]),_:1},8,["onClick"])]),_:1})])]),default:r(()=>[s(T,{type:"text",class:"user-dropdown-trigger"},{default:r(()=>[s(b,{size:"small",class:"trigger-avatar"},{icon:r(()=>[s(g)]),_:1}),s(I,{class:"dropdown-icon"})]),_:1})]),_:1},8,["onOpenChange"])])]),_:1}),l("div",be,[s(B,{width:"200",style:{background:"#fff"},class:"sider"},{default:r(()=>[s(m,{selectedKeys:e.selectedLeftKeysSource,"onUpdate:selectedKeys":t[1]||(t[1]=n=>e.selectedLeftKeysSource=n),openKeys:e.openKeysSource,"onUpdate:openKeys":t[2]||(t[2]=n=>e.openKeysSource=n),mode:"inline",items:e.leftMenuSource,onSelect:e.onLeftMenuSelect,style:{height:"100%",borderRight:0}},null,8,["selectedKeys","openKeys","items","onSelect"])]),_:1}),l("div",ye,[s(q,{style:{margin:"16px 0"}},{default:r(()=>[(h(!0),v(O,null,K(e.breadcrumbName,n=>(h(),V(j,{key:n},{default:r(()=>[d(i(n),1)]),_:2},1024))),128))]),_:1}),l("div",_e,[s(A)])])])]),_:1}),s(S,{open:e.userDetailVisible,"onUpdate:open":t[3]||(t[3]=n=>e.userDetailVisible=n),title:"用户详情",onOk:t[4]||(t[4]=n=>e.userDetailVisible=!1),onCancel:t[5]||(t[5]=n=>e.userDetailVisible=!1),width:"600px",footer:null},{default:r(()=>[l("div",ve,[l("div",Oe,[s(b,{size:"large",class:"detail-avatar"},{icon:r(()=>[s(g)]),_:1}),l("div",Pe,[l("div",Me,i(e.userDetail.nickname||e.user.nickname),1),l("div",Le,i(e.userDetail.username||e.user.username),1)])]),s(G,{column:1,bordered:"",class:"user-detail-descriptions"},{default:r(()=>[s(f,{label:"用户名"},{default:r(()=>[d(i(e.userDetail.username||e.user.username||"-"),1)]),_:1}),s(f,{label:"昵称"},{default:r(()=>[d(i(e.userDetail.nickname||e.user.nickname||"-"),1)]),_:1}),s(f,{label:"邮箱"},{default:r(()=>[d(i(e.userDetail.email||e.user.email||"-"),1)]),_:1}),s(f,{label:"手机号"},{default:r(()=>[d(i(e.userDetail.phone||e.user.phone||"-"),1)]),_:1}),s(f,{label:"角色"},{default:r(()=>[d(i(e.userDetail.roleName||e.user.roleName||"普通用户"),1)]),_:1}),s(f,{label:"状态"},{default:r(()=>[s(H,{status:e.getStatusBadge(e.userDetail.status),text:e.getStatusName(e.userDetail.status)},null,8,["status","text"])]),_:1}),s(f,{label:"创建时间"},{default:r(()=>[d(i(e.formatDate(e.userDetail.createTime)),1)]),_:1}),s(f,{label:"更新时间"},{default:r(()=>[d(i(e.formatDate(e.userDetail.updateTime)),1)]),_:1})]),_:1})])]),_:1},8,["open"]),s(S,{open:e.passwordModalVisible,"onUpdate:open":t[9]||(t[9]=n=>e.passwordModalVisible=n),title:"修改密码",onOk:e.handlePasswordSubmit,onCancel:e.closePasswordModal,width:"600px",confirmLoading:e.passwordLoading},{default:r(()=>[s(J,{ref:"passwordFormRef",model:e.passwordForm,rules:e.passwordRules,layout:"horizontal",class:"password-form",labelCol:{span:6},wrapperCol:{span:18}},{default:r(()=>[s(_,{label:"当前密码",name:"currentPassword"},{default:r(()=>[s(y,{value:e.passwordForm.currentPassword,"onUpdate:value":t[6]||(t[6]=n=>e.passwordForm.currentPassword=n),placeholder:"请输入当前密码",size:"large"},null,8,["value"])]),_:1}),s(_,{label:"新密码",name:"newPassword"},{default:r(()=>[s(y,{value:e.passwordForm.newPassword,"onUpdate:value":t[7]||(t[7]=n=>e.passwordForm.newPassword=n),placeholder:"请输入新密码",size:"large"},null,8,["value"])]),_:1}),s(_,{label:"确认新密码",name:"confirmPassword"},{default:r(()=>[s(y,{value:e.passwordForm.confirmPassword,"onUpdate:value":t[8]||(t[8]=n=>e.passwordForm.confirmPassword=n),placeholder:"请再次输入新密码",size:"large"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk","onCancel","confirmLoading"])],64)}const $e=x(ue,[["render",Se],["__scopeId","data-v-88f6bb98"]]);export{$e as default};
