import{d as z,r as g,a as b,i as Y,D as B,o as I,g as H,e as N,f as s,w as a,F as L,u as j,b as i,h as l,c as R,t as p,l as V}from"./index-aeb50595.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";import{U as J}from"./UserOutlined-05025d53.js";const G=z({props:{id:{type:[String,Number],default:void 0}},data(){const e=g({id:"",username:"",nickname:"",phone:"",email:"",certNo:"",stat:void 0,createTime:"",lockTime:"",lastUpdateTime:"",roleName:"",roleId:"",startCreateTime:"",endCreateTime:"",startLockTime:"",endLockTime:"",rangetimepicker:[]}),t=g([]),u=g([]),v=b(!1),c=b(""),k=b(!1),d=b(""),o=g({username:"",nickname:"",phone:"",email:"",certNo:"",roleIds:[]}),F=g([]),D=b(!1),w=g({id:"",username:"",newPassword:"",confirmPassword:""}),S=b(!1),P=g({username:"",nickname:"",phone:"",email:"",certNo:"",stat:"",createTime:"",roleName:"",lastUpdateTime:""});return{formState:e,data:t,roleSource:u,modalVisible:v,modalTitle:c,isEdit:k,currentUserId:d,userForm:o,roleOptions:F,userFormRules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{required:!1,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur",validator:(y,m)=>!m||m===""||/^1[3-9]\d{9}$/.test(m)?Promise.resolve():Promise.reject("请输入正确的手机号格式")}],email:[{required:!1,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur",validator:(y,m)=>!m||m===""||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m)?Promise.resolve():Promise.reject("请输入正确的邮箱格式")}],certNo:[{required:!1,message:"请输入证件号码",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",trigger:"change"}]},resetPasswordVisible:D,resetPasswordForm:w,resetPasswordRules:{newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(y,m)=>m!==this.resetPasswordForm.newPassword?Promise.reject("两次输入的密码不一致"):Promise.resolve(),trigger:"blur"}]},userDetailVisible:S,userDetail:P}},computed:{...Y(j,["tokenVal"]),tableData:function(){return this.data},headers:function(){return{Authorization:"xtoken "+this.tokenVal}},uploadUrl:function(){return this.$cfg.rootUrl()+"/personkit/disk/file/import"}},methods:{handleFinish(){this.formState.rangetimepicker&&this.formState.rangetimepicker.length===2?(this.formState.startCreateTime=this.formState.rangetimepicker[0],this.formState.endCreateTime=this.formState.rangetimepicker[1]):(this.formState.startCreateTime="",this.formState.endCreateTime=""),this.query()},handleReset(){this.formState.username="",this.formState.nickname="",this.formState.phone="",this.formState.email="",this.formState.certNo="",this.formState.roleId=void 0,this.formState.stat=void 0,this.formState.rangetimepicker=[],this.formState.startCreateTime="",this.formState.endCreateTime="",this.pagination.current=1,this.query()},handleRoleSearch(e){this.$http.request({url:"/personkit/sys/role/page",data:{num:1,query:{name:e},size:1e3}}).then(t=>{this.roleSource=t.data.map(u=>({label:u.name,value:u.id}))}).catch(t=>{console.error(t),this.$msg.error("操作失败")})},query(){this.$http.request({url:"/personkit/sys/user/findPage",data:{num:this.pagination.current,query:this.formState,size:this.pagination.pageSize}}).then(e=>{this.pagination.current=e.num,this.pagination.total=e.total,this.data=g(e.data)}).catch(e=>console.log(e))},handleChange(e){e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?this.$msg.success(`${e.file.name} file uploaded successfully`):e.file.status==="error"&&this.$msg.error(`${e.file.name} file upload failed.`),this.query()},onPaginationChange(e,t){this.pagination.current=e,this.query()},showDetail(e){sessionStorage.setItem("current_view_file",JSON.stringify(e)),this.$router.push({name:"data_source_detail",query:{record:e.id}})},showCreateModal(){this.isEdit=!1,this.modalTitle="创建账号",this.resetUserForm(),this.loadRoleOptions(),this.modalVisible=!0},showEditModal(e){this.isEdit=!0,this.modalTitle="编辑账号",this.resetUserForm(),this.loadRoleOptions(),this.currentUserId=e.id,this.userForm.username=e.username,this.userForm.nickname=e.nickname,this.userForm.phone=e.phone,this.userForm.email=e.email,this.userForm.certNo=e.certNo,this.userForm.roleIds=e.roles?e.roles.map(t=>t.key):[],this.modalVisible=!0},resetUserForm(){this.userForm.username="",this.userForm.nickname="",this.userForm.phone="",this.userForm.email="",this.userForm.certNo="",this.userForm.roleIds=[],this.currentUserId=""},loadRoleOptions(){this.$http.request({url:"/personkit/sys/role/page",data:{num:1,query:{},size:1e3}}).then(e=>{this.roleOptions=e.data.map(t=>({label:t.name,value:t.id}))}).catch(e=>console.log(e))},handleModalOk(){this.$refs.userFormRef.validate().then(()=>{const e=this.isEdit?"/personkit/sys/user/update":"/personkit/sys/user/create",t={username:this.userForm.username,nickname:this.userForm.nickname,email:this.userForm.email,roleIds:this.userForm.roleIds};this.isEdit&&(t.id=this.currentUserId),this.userForm.phone&&this.userForm.phone.trim()!==""&&(t.phone=this.userForm.phone.trim()),this.userForm.certNo&&this.userForm.certNo.trim()!==""&&(t.certNo=this.userForm.certNo.trim()),this.$http.request({url:e,data:t}).then(u=>{this.$msg.success(this.isEdit?"编辑成功":"创建成功"),this.modalVisible=!1,this.query()}).catch(u=>{this.$msg.error(this.isEdit?"编辑失败":"创建失败"),console.log(u)})}).catch(()=>{})},handleModalCancel(){this.modalVisible=!1,this.resetUserForm()},handleOperationMenu(e,t){switch(t){case"updatePassword":this.showResetPasswordModal(e);break;case"detail":this.showDetailModal(e);break;case"delete":this.handleDelete(e);break}},showResetPasswordModal(e){this.resetPasswordForm.id=e.id,this.resetPasswordForm.username=e.username,this.resetPasswordForm.newPassword="",this.resetPasswordForm.confirmPassword="",this.resetPasswordVisible=!0},handleResetPassword(){this.$refs.resetPasswordFormRef.validate().then(()=>{this.$http.request({url:"/personkit/sys/user/updatePassword",data:{id:this.resetPasswordForm.id,password:this.resetPasswordForm.newPassword}}).then(e=>{this.$msg.success("密码重置成功"),this.resetPasswordVisible=!1,this.resetPasswordForm.id="",this.resetPasswordForm.username="",this.resetPasswordForm.newPassword="",this.resetPasswordForm.confirmPassword=""}).catch(e=>{this.$msg.error("密码重置失败"),console.log(e)})}).catch(()=>{})},handleResetPasswordCancel(){this.resetPasswordVisible=!1,this.resetPasswordForm.id="",this.resetPasswordForm.username="",this.resetPasswordForm.newPassword="",this.resetPasswordForm.confirmPassword=""},showDetailModal(e){this.userDetail.username=e.username,this.userDetail.nickname=e.nickname,this.userDetail.phone=e.phone,this.userDetail.email=e.email,this.userDetail.certNo=e.certNo,this.userDetail.stat=this.getStatusName(e.stat),this.userDetail.createTime=e.createTime,this.userDetail.roleName=e.roleName,this.userDetail.lastUpdateTime=e.lastUpdateTime,this.userDetailVisible=!0},getStatusName(e){return{0:"账号正常",1:"账号禁用",2:"账号过期",3:"密码过期",4:"账号锁定"}[e]||"未知状态"},handleDelete(e){this.$confirm({title:"确认删除用户",content:`确定要删除用户【${e.username}】吗？此操作不可恢复。`,okText:"确认删除",cancelText:"取消",okButtonProps:{type:"primary",danger:!0},onOk:()=>this.$http.request({url:"/personkit/sys/user/delete",data:{id:e.id}}).then(t=>{this.$msg.success("用户删除成功"),this.query()}).catch(t=>{this.$msg.error("用户删除失败"),console.log(t)}),onCancel:()=>{}})},handleStatusChange(e,t){if(e.stat===parseInt(t))return;const u={0:"账号正常",1:"账号禁用",2:"账号过期",3:"密码过期",4:"账号锁定"},v=u[t],c=u[e.stat];this.$confirm({title:"确认修改状态",content:`确定要将用户【${e.username}】的状态从【${c}】修改为【${v}】吗？`,okText:"确认",cancelText:"取消",onOk:()=>this.$http.request({url:"/personkit/sys/user/updateStat",data:{id:e.id,stat:parseInt(t)}}).then(k=>{this.$msg.success("状态修改成功"),this.query()}).catch(k=>{this.$msg.error("状态修改失败"),console.log(k)}),onCancel:()=>{}})}},components:{UserOutlined:J,DownOutlined:B},mounted(){this.handleRoleSearch(""),this.query()},setup(){const e=[{title:"账号",dataIndex:"username",key:"username",align:"center",fixed:"left",width:150},{title:"昵称",dataIndex:"nickname",key:"nickname",align:"center",width:150,fixed:"left"},{title:"角色",dataIndex:"roleName",key:"roleName",ellipsis:!0,align:"center",width:100,fixed:"left"},{title:"状态",dataIndex:"stat",key:"stat",ellipsis:!0,width:100,align:"center"},{title:"邮箱",dataIndex:"email",key:"email",ellipsis:!0,width:150,align:"center"},{title:"证件号码",dataIndex:"certNo",key:"certNo",ellipsis:!0,width:150,align:"center"},{title:"手机号",dataIndex:"phone",key:"phone",width:150,ellipsis:!0,align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150,ellipsis:!0,align:"center"},{title:"最后登录时间",dataIndex:"userName",key:"userName",width:100,ellipsis:!0,align:"center"},{title:"操作",dataIndex:"action",key:"action",width:300,align:"center",fixed:"right"}],t={current:1,total:0,pageSize:10},u=b([]),v={style:{width:"80px"}},c={span:14},k=g([{label:"账号正常",value:0},{label:"账号禁用",value:1},{label:"账号过期",value:2},{label:"密码过期",value:3},{label:"账号锁定",value:4}]);return{columns:e,pagination:t,fileList:u,labelCol:v,wrapperCol:c,userStatusOptions:k}}}),K={class:"page-content-wrapper"},Q={class:"search-area"},W={class:"content-min-height"},X={style:{"margin-top":"15px",float:"right"}};function Z(e,t,u,v,c,k){const d=i("a-input"),o=i("a-form-item"),F=i("a-select"),D=i("a-range-picker"),w=i("a-button"),S=i("a-space"),P=i("a-form"),T=i("a-tag"),h=i("a-menu-item"),y=i("a-menu"),m=i("DownOutlined"),$=i("a-dropdown"),O=i("a-table"),M=i("a-pagination"),U=i("a-modal"),q=i("a-input-password"),f=i("a-descriptions-item"),E=i("a-descriptions");return I(),H(L,null,[N("div",K,[N("div",Q,[s(P,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish,"label-col":e.labelCol},{default:a(()=>[s(o,{label:"账号",name:"username",class:"input"},{default:a(()=>[s(d,{allowClear:"",value:e.formState.username,"onUpdate:value":t[0]||(t[0]=r=>e.formState.username=r),placeholder:"账号，模糊查询"},null,8,["value"])]),_:1}),s(o,{label:"昵称",name:"nickname",class:"input"},{default:a(()=>[s(d,{allowClear:"",value:e.formState.nickname,"onUpdate:value":t[1]||(t[1]=r=>e.formState.nickname=r),placeholder:"昵称，模糊查询"},null,8,["value"])]),_:1}),s(o,{label:"手机号",name:"phone",class:"input"},{default:a(()=>[s(d,{allowClear:"",value:e.formState.phone,"onUpdate:value":t[2]||(t[2]=r=>e.formState.phone=r),placeholder:"手机号，模糊查询"},null,8,["value"])]),_:1}),s(o,{label:"邮箱",name:"email",class:"input"},{default:a(()=>[s(d,{allowClear:"",value:e.formState.email,"onUpdate:value":t[3]||(t[3]=r=>e.formState.email=r),placeholder:"邮箱，模糊查询"},null,8,["value"])]),_:1}),s(o,{label:"证件号码",name:"certNo",class:"input"},{default:a(()=>[s(d,{allowClear:"",value:e.formState.certNo,"onUpdate:value":t[4]||(t[4]=r=>e.formState.certNo=r),placeholder:"证件号码，模糊查询"},null,8,["value"])]),_:1}),s(o,{label:"角色",name:"roleId",class:"input"},{default:a(()=>[s(F,{allowClear:"",style:{width:"180px"},value:e.formState.roleId,"onUpdate:value":t[5]||(t[5]=r=>e.formState.roleId=r),"show-search":"",placeholder:"请选择角色","default-active-first-option":!1,"show-arrow":!0,"filter-option":!1,"not-found-content":null,options:e.roleSource,onSearch:e.handleRoleSearch,onFocus:t[6]||(t[6]=r=>e.handleRoleSearch(""))},null,8,["value","options","onSearch"])]),_:1}),s(o,{label:"状态",name:"stat",class:"input"},{default:a(()=>[s(F,{allowClear:"",style:{width:"180px"},placeholder:"状态",value:e.formState.stat,"onUpdate:value":t[7]||(t[7]=r=>e.formState.stat=r),options:e.userStatusOptions},null,8,["value","options"])]),_:1}),s(o,{label:"创建时间",name:"fileName",class:"input"},{default:a(()=>[s(D,{allowClear:"",value:e.formState.rangetimepicker,"onUpdate:value":t[8]||(t[8]=r=>e.formState.rangetimepicker=r),placeholder:["开始时间","结束时间"],"show-time":"",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),s(S,null,{default:a(()=>[s(w,{type:"primary","html-type":"submit"},{default:a(()=>[...t[23]||(t[23]=[l(" 搜索 ",-1)])]),_:1}),s(w,{onClick:e.handleReset},{default:a(()=>[...t[24]||(t[24]=[l(" 重置 ",-1)])]),_:1},8,["onClick"]),s(w,{type:"primary",onClick:e.showCreateModal},{default:a(()=>[...t[25]||(t[25]=[l(" 创建账号 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish","label-col"])]),N("div",W,[s(O,{columns:e.columns,"data-source":e.tableData,pagination:!1,scroll:{x:1500},size:"small"},{bodyCell:a(({column:r,record:n})=>[r.dataIndex==="stat"?(I(),R(T,{key:0,color:n.stat===0?"green":n.stat===1?"red":n.stat===2?"orange":n.stat===3?"blue":"purple"},{default:a(()=>[l(p(n.stat===0?"账号正常":n.stat===1?"账号禁用":n.stat===2?"账号过期":n.stat===3?"密码过期":"账号锁定"),1)]),_:2},1032,["color"])):V("",!0),r.dataIndex==="action"?(I(),R(S,{key:1,size:2},{default:a(()=>[s(w,{type:"link",onClick:C=>e.showEditModal(n)},{default:a(()=>[...t[26]||(t[26]=[l("编辑",-1)])]),_:1},8,["onClick"]),s($,null,{overlay:a(()=>[s(y,{onClick:({key:C})=>e.handleOperationMenu(n,C)},{default:a(()=>[s(h,{key:"updatePassword"},{default:a(()=>[...t[27]||(t[27]=[l("修改密码",-1)])]),_:1}),s(h,{key:"detail"},{default:a(()=>[...t[28]||(t[28]=[l("详情",-1)])]),_:1}),s(h,{key:"delete",style:{color:"#ff4d4f"}},{default:a(()=>[...t[29]||(t[29]=[l("删除",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[s(w,{type:"link"},{default:a(()=>[t[30]||(t[30]=l(" 操作 ",-1)),s(m)]),_:1})]),_:2},1024),s($,null,{overlay:a(()=>[s(y,{onClick:({key:C})=>e.handleStatusChange(n,C)},{default:a(()=>[s(h,{key:"0",disabled:n.stat===0},{default:a(()=>[...t[31]||(t[31]=[l("账号正常",-1)])]),_:1},8,["disabled"]),s(h,{key:"1",disabled:n.stat===1},{default:a(()=>[...t[32]||(t[32]=[l("账号禁用",-1)])]),_:1},8,["disabled"]),s(h,{key:"2",disabled:n.stat===2},{default:a(()=>[...t[33]||(t[33]=[l("账号过期",-1)])]),_:1},8,["disabled"]),s(h,{key:"3",disabled:n.stat===3},{default:a(()=>[...t[34]||(t[34]=[l("密码过期",-1)])]),_:1},8,["disabled"]),s(h,{key:"4",disabled:n.stat===4},{default:a(()=>[...t[35]||(t[35]=[l("账号锁定",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onClick"])]),default:a(()=>[s(w,{type:"link"},{default:a(()=>[t[36]||(t[36]=l(" 修改状态 ",-1)),s(m)]),_:1})]),_:2},1024)]),_:2},1024)):V("",!0)]),_:1},8,["columns","data-source"]),N("div",X,[s(M,{current:e.pagination.current,"onUpdate:current":t[9]||(t[9]=r=>e.pagination.current=r),total:e.pagination.total,"show-total":r=>`共 ${r} 条数据`,onChange:e.onPaginationChange},null,8,["current","total","show-total","onChange"])])])]),s(U,{open:e.modalVisible,"onUpdate:open":t[16]||(t[16]=r=>e.modalVisible=r),title:e.modalTitle,onOk:e.handleModalOk,onCancel:e.handleModalCancel,width:"600px"},{default:a(()=>[s(P,{ref:"userFormRef",model:e.userForm,"label-col":{span:6},"wrapper-col":{span:16},rules:e.userFormRules},{default:a(()=>[s(o,{label:"账号",name:"username"},{default:a(()=>[s(d,{value:e.userForm.username,"onUpdate:value":t[10]||(t[10]=r=>e.userForm.username=r),placeholder:"请输入账号",disabled:e.isEdit},null,8,["value","disabled"])]),_:1}),s(o,{label:"昵称",name:"nickname"},{default:a(()=>[s(d,{value:e.userForm.nickname,"onUpdate:value":t[11]||(t[11]=r=>e.userForm.nickname=r),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),s(o,{label:"手机号",name:"phone"},{default:a(()=>[s(d,{value:e.userForm.phone,"onUpdate:value":t[12]||(t[12]=r=>e.userForm.phone=r),placeholder:"请输入手机号（选填）"},null,8,["value"])]),_:1}),s(o,{label:"邮箱",name:"email"},{default:a(()=>[s(d,{value:e.userForm.email,"onUpdate:value":t[13]||(t[13]=r=>e.userForm.email=r),placeholder:"请输入邮箱（选填）"},null,8,["value"])]),_:1}),s(o,{label:"证件号码",name:"certNo"},{default:a(()=>[s(d,{value:e.userForm.certNo,"onUpdate:value":t[14]||(t[14]=r=>e.userForm.certNo=r),placeholder:"请输入证件号码（选填）"},null,8,["value"])]),_:1}),s(o,{label:"角色",name:"roleIds"},{default:a(()=>[s(F,{value:e.userForm.roleIds,"onUpdate:value":t[15]||(t[15]=r=>e.userForm.roleIds=r),mode:"multiple",placeholder:"请选择角色",options:e.roleOptions},null,8,["value","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","onOk","onCancel"]),s(U,{open:e.resetPasswordVisible,"onUpdate:open":t[20]||(t[20]=r=>e.resetPasswordVisible=r),title:"修改密码",onOk:e.handleResetPassword,onCancel:e.handleResetPasswordCancel,width:"400px"},{default:a(()=>[s(P,{ref:"resetPasswordFormRef",model:e.resetPasswordForm,"label-col":{span:6},"wrapper-col":{span:16},rules:e.resetPasswordRules},{default:a(()=>[s(o,{label:"用户名"},{default:a(()=>[s(d,{value:e.resetPasswordForm.username,"onUpdate:value":t[17]||(t[17]=r=>e.resetPasswordForm.username=r),disabled:""},null,8,["value"])]),_:1}),s(o,{label:"新密码",name:"newPassword"},{default:a(()=>[s(q,{value:e.resetPasswordForm.newPassword,"onUpdate:value":t[18]||(t[18]=r=>e.resetPasswordForm.newPassword=r),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),s(o,{label:"确认密码",name:"confirmPassword"},{default:a(()=>[s(q,{value:e.resetPasswordForm.confirmPassword,"onUpdate:value":t[19]||(t[19]=r=>e.resetPasswordForm.confirmPassword=r),placeholder:"请确认新密码"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk","onCancel"]),s(U,{open:e.userDetailVisible,"onUpdate:open":t[21]||(t[21]=r=>e.userDetailVisible=r),title:"用户详情",onCancel:t[22]||(t[22]=r=>e.userDetailVisible=!1),width:"500px",footer:null},{default:a(()=>[s(E,{column:1,bordered:""},{default:a(()=>[s(f,{label:"账号"},{default:a(()=>[l(p(e.userDetail.username),1)]),_:1}),s(f,{label:"昵称"},{default:a(()=>[l(p(e.userDetail.nickname),1)]),_:1}),s(f,{label:"手机号"},{default:a(()=>[l(p(e.userDetail.phone||"-"),1)]),_:1}),s(f,{label:"邮箱"},{default:a(()=>[l(p(e.userDetail.email||"-"),1)]),_:1}),s(f,{label:"证件号码"},{default:a(()=>[l(p(e.userDetail.certNo||"-"),1)]),_:1}),s(f,{label:"状态"},{default:a(()=>[l(p(e.userDetail.stat),1)]),_:1}),s(f,{label:"角色"},{default:a(()=>[l(p(e.userDetail.roleName),1)]),_:1}),s(f,{label:"创建时间"},{default:a(()=>[l(p(e.userDetail.createTime),1)]),_:1}),s(f,{label:"最后更新时间"},{default:a(()=>[l(p(e.userDetail.lastUpdateTime),1)]),_:1})]),_:1})]),_:1},8,["open"])],64)}const te=A(G,[["render",Z],["__scopeId","data-v-851fa55e"]]);export{te as default};
