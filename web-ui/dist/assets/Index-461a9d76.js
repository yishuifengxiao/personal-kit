import{d as _,r as l,i as C,k as d,M as q,_ as I,a as D,o as v,g as $,f as a,w as i,e as c,u as N,b as o,h as m,c as B,l as U}from"./index-8cadae33.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";import{U as P}from"./UserOutlined-839a9000.js";const M=_({data(){const e=l({uri:void 0,method:void 0,userName:void 0,startTime:void 0,endTime:void 0}),t=l([]),r=l([]);return{formState:e,data:t,roleSource:r}},computed:{...C(N,["tokenVal"]),tableData:function(){return this.data},headers:function(){return{Authorization:"xtoken "+this.tokenVal}},uploadUrl:function(){return this.$cfg.rootUrl()+"/personkit/disk/file/import"}},methods:{handleFinish(){try{this.query()}catch(e){console.error("表单提交处理错误:",e),d.error("搜索操作失败: "+(e.message||"未知错误"))}},formatBeijingTime(e){if(e)try{const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?void 0:new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,19).replace("T"," ")}catch(t){console.error("时间格式转换错误:",t);return}},handleReset(){this.formState=l({uri:void 0,method:void 0,userName:void 0,startTime:void 0,endTime:void 0}),this.pagination.current=1,this.query()},handleClear(){q.confirm({title:"确认清空",content:"确定要清空所有HTTP访问记录吗？此操作不可恢复。",okText:"确认",cancelText:"取消",okType:"danger",onOk:()=>{this.$http.request({url:"/personkit/record/personal/visitRecord/clear",method:"post"}).then(()=>{d.success("清空数据成功"),this.query()}).catch(e=>{console.error("清空数据失败:",e),d.error("清空数据失败")})}})},query(){try{const e={...this.formState,startTime:this.formatBeijingTime(this.formState.startTime),endTime:this.formatBeijingTime(this.formState.endTime)};this.$http.request({url:"/personkit/record/personal/visit/page",data:{num:this.pagination.current,query:e,size:this.pagination.pageSize}}).then(t=>{this.pagination.current=t.num,this.pagination.total=t.total,this.data=l(t.data)}).catch(t=>{console.error("查询数据失败:",t),d.error("查询数据失败: "+(t.message||"未知错误"))})}catch(e){console.error("查询方法执行错误:",e),d.error("查询数据时发生错误")}},handleChange(e){e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?this.$msg.success(`${e.file.name} file uploaded successfully`):e.file.status==="error"&&this.$msg.error(`${e.file.name} file upload failed.`),this.query()},onPaginationChange(e,t){this.pagination.current=e,this.query()},showDetail(e){sessionStorage.setItem("current_view_file",JSON.stringify(e)),this.$router.push({name:"data_source_detail",query:{record:e.id}})}},components:{UserOutlined:P,ADatePicker:I},mounted(){this.query()},setup(){const e=[{title:"请求地址",dataIndex:"uri",key:"uri",align:"center",fixed:"left",ellipsis:!0,width:150},{title:"方法",dataIndex:"method",key:"method",align:"center",ellipsis:!0,width:80,fixed:"left"},{title:"请求参数",dataIndex:"queryParam",key:"queryParam",ellipsis:!0,align:"center",width:100,fixed:"left"},{title:"请求头",dataIndex:"headerParam",key:"headerParam",ellipsis:!0,width:100,align:"center"},{title:"请求体",dataIndex:"requestBody",key:"requestBody",ellipsis:!0,width:150,align:"center"},{title:"响应数据",dataIndex:"responseBody",key:"responseBody",ellipsis:!0,width:150,align:"center"},{title:"耗时(毫秒)",dataIndex:"useMillis",key:"useMillis",width:100,ellipsis:!0,align:"center"},{title:"请求时间",dataIndex:"createTime",key:"createTime",width:100,ellipsis:!0,align:"center"},{title:"操作",dataIndex:"action",key:"action",width:100,align:"center",fixed:"right"}],t={current:1,total:0,pageSize:10},r=D([]),h={style:{width:"80px"}},g={span:14},y=l([{label:"账号正常",value:0},{label:"账号禁用",value:1},{label:"账号过期",value:2},{label:"密码过期",value:3},{label:"账号锁定",value:4}]);return{columns:e,pagination:t,fileList:r,labelCol:h,wrapperCol:g,userStatusOptions:y}}}),Y={class:"high-data-table"},z={style:{"margin-top":"16px"}},O={style:{"margin-top":"15px",float:"right"}};function V(e,t,r,h,g,y){const p=o("a-input"),s=o("a-form-item"),k=o("a-date-picker"),u=o("a-button"),b=o("a-space"),T=o("a-form"),w=o("a-table"),S=o("a-pagination");return v(),$("div",Y,[a(T,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish,"label-col":e.labelCol},{default:i(()=>[a(s,{label:"请求地址",name:"uri",class:"input"},{default:i(()=>[a(p,{allowClear:"",value:e.formState.uri,"onUpdate:value":t[0]||(t[0]=n=>e.formState.uri=n),placeholder:"请求地址，模糊查询"},null,8,["value"])]),_:1}),a(s,{label:"请求方法",name:"method",class:"input"},{default:i(()=>[a(p,{allowClear:"",value:e.formState.method,"onUpdate:value":t[1]||(t[1]=n=>e.formState.method=n),placeholder:"请求方法，模糊查询"},null,8,["value"])]),_:1}),a(s,{label:"操作用户",name:"userName",class:"input"},{default:i(()=>[a(p,{allowClear:"",value:e.formState.userName,"onUpdate:value":t[2]||(t[2]=n=>e.formState.userName=n),placeholder:"操作用户，模糊查询"},null,8,["value"])]),_:1}),a(s,{label:"起始时间",name:"startTime",class:"input"},{default:i(()=>[a(k,{value:e.formState.startTime,"onUpdate:value":t[3]||(t[3]=n=>e.formState.startTime=n),placeholder:"选择起始时间","show-time":"",format:"YYYY-MM-DD HH:mm:ss",style:{width:"200px"}},null,8,["value"])]),_:1}),a(s,{label:"结束时间",name:"endTime",class:"input"},{default:i(()=>[a(k,{value:e.formState.endTime,"onUpdate:value":t[4]||(t[4]=n=>e.formState.endTime=n),placeholder:"选择结束时间","show-time":"",format:"YYYY-MM-DD HH:mm:ss",style:{width:"200px"}},null,8,["value"])]),_:1}),a(b,{class:"input"},{default:i(()=>[a(u,{type:"primary","html-type":"submit"},{default:i(()=>[...t[6]||(t[6]=[m(" 搜索 ",-1)])]),_:1}),a(u,{onClick:e.handleReset},{default:i(()=>[...t[7]||(t[7]=[m(" 重置 ",-1)])]),_:1},8,["onClick"]),a(u,{type:"dashed",danger:"",onClick:e.handleClear},{default:i(()=>[...t[8]||(t[8]=[m(" 清空 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish","label-col"]),c("div",z,[a(w,{columns:e.columns,"data-source":e.tableData,pagination:!1,size:"small",scroll:{x:1500}},{bodyCell:i(({column:n,record:f})=>[n.dataIndex==="action"?(v(),B(b,{key:0},{default:i(()=>[a(u,{type:"link",onClick:j=>e.showDetail(f),disabled:f.stat!=2||f.actualTotalNum===0},{default:i(()=>[...t[9]||(t[9]=[m("详情",-1)])]),_:1},8,["onClick","disabled"]),t[10]||(t[10]=c("a",null,"删除",-1))]),_:2},1024)):U("",!0)]),_:1},8,["columns","data-source"]),c("div",O,[a(S,{current:e.pagination.current,"onUpdate:current":t[5]||(t[5]=n=>e.pagination.current=n),total:e.pagination.total,"show-total":n=>`共 ${n} 条数据`,onChange:e.onPaginationChange},null,8,["current","total","show-total","onChange"])])])])}const A=x(M,[["render",V],["__scopeId","data-v-bc3ebd1d"]]);export{A as default};
