import{f as a,A as F,d as E,S as L,J,R as G,D as Q,r as f,a as W,x as X,o as p,g as I,e as C,w as n,s as h,F as Z,u as K,b as i,h as o,c as y,t as d}from"./index-64e3746b.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const ae=te;function N(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?Object(arguments[t]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable}))),c.forEach(function(r){ne(e,r,s[r])})}return e}function ne(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var D=function(t,s){var c=N({},t,s.attrs);return a(F,N({},c,{icon:ae}),null)};D.displayName="AimOutlined";D.inheritAttrs=!1;const ie=D;const le=E({components:{SearchOutlined:L,CheckCircleOutlined:J,AimOutlined:ie,ReloadOutlined:G,DownOutlined:Q},props:{id:{type:[String,Number],default:void 0}},data(){const e=f({keyword:"",userName:"",startTime:"",endTime:"",rangetimepicker:[]}),t=f([]),s=[{title:"用户名称",dataIndex:"userName",key:"userName",width:120,ellipsis:!0},{title:"搜索关键词",dataIndex:"keyword",key:"keyword",width:150,ellipsis:!0},{title:"搜索时间",dataIndex:"searchTime",key:"searchTime",width:160},{title:"结果总数",dataIndex:"totalResults",key:"totalResults",width:90,align:"center"},{title:"点击位置",dataIndex:"clickedPosition",key:"clickedPosition",width:90,align:"center",customRender:({text:k})=>k||"-"},{title:"点击标题",dataIndex:"clickedTitle",key:"clickedTitle",width:200,ellipsis:!0,customRender:({text:k})=>k||"-"},{title:"是否点击",dataIndex:"clickedResult",key:"clickedResult",width:90,align:"center"},{title:"准确率",dataIndex:"accuracy",key:"accuracy",width:120,align:"center"},{title:"精确率",dataIndex:"precision",key:"precision",width:120,align:"center"},{title:"召回率",dataIndex:"recall",key:"recall",width:120,align:"center"},{title:"操作",dataIndex:"action",key:"action",width:120,align:"center",fixed:"right"}],c=f({current:1,pageSize:10,total:0}),r=f({span:8}),T=W(!1),b=f({id:"",userName:"",keyword:"",searchTime:"",totalResults:0,clickedPosition:null,clickedTitle:"",clickedResult:!1,accuracy:0,precision:0,recall:0}),g=f({totalSearchCount:0,avgAccuracy:0,avgPrecision:0,avgRecall:0});return{formState:e,data:t,columns:s,pagination:c,labelCol:r,detailVisible:T,currentDetail:b,statistics:g}},computed:{...X(K,["tokenVal"]),tableData:function(){return this.data},headers:function(){return{Authorization:"xtoken "+this.tokenVal}}},methods:{handleFinish(){this.formState.rangetimepicker&&this.formState.rangetimepicker.length===2?(this.formState.startTime=this.formState.rangetimepicker[0],this.formState.endTime=this.formState.rangetimepicker[1]):(this.formState.startTime="",this.formState.endTime=""),this.query()},handleReset(){this.formState.keyword="",this.formState.userName="",this.formState.startTime="",this.formState.endTime="",this.formState.rangetimepicker=[],this.query()},handleExport(){const e={keyword:this.formState.keyword,userName:this.formState.userName,startTime:this.formState.startTime,endTime:this.formState.endTime};this.$http.request({url:this.$cfg.rootUrl()+"/personkit/search/analyze/export",method:"post",data:e,responseType:"blob"}).then(t=>{const s=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(s),r=document.createElement("a");r.href=c,r.download=`搜索分析数据_${new Date().toLocaleDateString()}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(c),this.$message.success("导出成功")}).catch(t=>{this.$message.error("导出失败: "+t)})},showDetailModal(e){Object.assign(this.currentDetail,e),this.detailVisible=!0},handleDelete(e){this.$http.request({url:this.$cfg.rootUrl()+"/personkit/search/analyze/delete/"+e,method:"delete"}).then(()=>{this.$message.success("删除成功"),this.query()}).catch(t=>{this.$message.error("删除失败: "+t)})},onPaginationChange(e){this.pagination.current=e,this.query()},query(){const e={num:this.pagination.current,size:this.pagination.pageSize,query:{keyword:this.formState.keyword,userName:this.formState.userName,startTime:this.formState.startTime,endTime:this.formState.endTime}};this.$http.request({url:this.$cfg.rootUrl()+"/personkit/search/analyze/page",method:"post",data:e}).then(t=>{this.data.splice(0,this.data.length,...t.data),this.pagination.total=t.total,t.statistics&&Object.assign(this.statistics,t.statistics)}).catch(t=>{this.$message.error("查询失败: "+t)})}},created(){this.query()}}),oe={class:"page-content-wrapper"},se={class:"search-area"},re={key:0,class:"statistics-area"},ce={class:"content-min-height"},de={style:{"margin-top":"15px",float:"right"}};function ue(e,t,s,c,r,T){const b=i("a-input"),g=i("a-form-item"),k=i("a-range-picker"),_=i("a-button"),R=i("a-space"),A=i("a-form"),z=i("SearchOutlined"),v=i("a-statistic"),w=i("a-card"),S=i("a-col"),V=i("CheckCircleOutlined"),P=i("AimOutlined"),U=i("ReloadOutlined"),q=i("a-row"),$=i("a-tag"),O=i("a-progress"),M=i("a-popconfirm"),j=i("a-table"),x=i("a-pagination"),u=i("a-descriptions-item"),Y=i("a-descriptions"),H=i("a-modal");return p(),I(Z,null,[C("div",oe,[C("div",se,[a(A,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish,"label-col":e.labelCol},{default:n(()=>[a(g,{label:"搜索关键词",name:"keyword",class:"input"},{default:n(()=>[a(b,{allowClear:"",value:e.formState.keyword,"onUpdate:value":t[0]||(t[0]=l=>e.formState.keyword=l),placeholder:"搜索关键词，模糊查询"},null,8,["value"])]),_:1}),a(g,{label:"用户名称",name:"userName",class:"input"},{default:n(()=>[a(b,{allowClear:"",value:e.formState.userName,"onUpdate:value":t[1]||(t[1]=l=>e.formState.userName=l),placeholder:"用户名称，模糊查询"},null,8,["value"])]),_:1}),a(g,{label:"搜索时间",name:"searchTime",class:"input"},{default:n(()=>[a(k,{allowClear:"",value:e.formState.rangetimepicker,"onUpdate:value":t[2]||(t[2]=l=>e.formState.rangetimepicker=l),placeholder:["开始时间","结束时间"],"show-time":"",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),a(R,null,{default:n(()=>[a(_,{type:"primary","html-type":"submit"},{default:n(()=>[...t[6]||(t[6]=[o(" 搜索 ",-1)])]),_:1}),a(_,{onClick:e.handleReset},{default:n(()=>[...t[7]||(t[7]=[o(" 重置 ",-1)])]),_:1},8,["onClick"]),a(_,{type:"primary",onClick:e.handleExport},{default:n(()=>[...t[8]||(t[8]=[o(" 导出 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish","label-col"])]),e.statistics.totalSearchCount>0?(p(),I("div",re,[a(q,{gutter:16},{default:n(()=>[a(S,{span:6},{default:n(()=>[a(w,null,{default:n(()=>[a(v,{title:"总搜索次数",value:e.statistics.totalSearchCount,"value-style":{color:"#3f8600"}},{prefix:n(()=>[a(z)]),_:1},8,["value"])]),_:1})]),_:1}),a(S,{span:6},{default:n(()=>[a(w,null,{default:n(()=>[a(v,{title:"平均准确率",value:e.statistics.avgAccuracy,precision:1,suffix:"%","value-style":{color:"#1890ff"}},{prefix:n(()=>[a(V)]),_:1},8,["value"])]),_:1})]),_:1}),a(S,{span:6},{default:n(()=>[a(w,null,{default:n(()=>[a(v,{title:"平均精确率",value:e.statistics.avgPrecision,precision:1,suffix:"%","value-style":{color:"#fa8c16"}},{prefix:n(()=>[a(P)]),_:1},8,["value"])]),_:1})]),_:1}),a(S,{span:6},{default:n(()=>[a(w,null,{default:n(()=>[a(v,{title:"平均召回率",value:e.statistics.avgRecall,precision:1,suffix:"%","value-style":{color:"#722ed1"}},{prefix:n(()=>[a(U)]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})])):h("",!0),C("div",ce,[a(j,{columns:e.columns,"data-source":e.tableData,pagination:!1,scroll:{x:1500},size:"small",rowKey:"id"},{bodyCell:n(({column:l,record:m})=>[l.dataIndex==="clickedResult"?(p(),y($,{key:0,color:m.clickedResult?"green":"red"},{default:n(()=>[o(d(m.clickedResult?"已点击":"未点击"),1)]),_:2},1032,["color"])):h("",!0),l.dataIndex==="accuracy"?(p(),y(O,{key:1,percent:m.accuracy,"stroke-color":{"0%":"#108ee9","100%":"#87d068"},size:"small"},null,8,["percent"])):h("",!0),l.dataIndex==="precision"?(p(),y(O,{key:2,percent:m.precision,"stroke-color":{"0%":"#fa8c16","100%":"#fa541c"},size:"small"},null,8,["percent"])):h("",!0),l.dataIndex==="recall"?(p(),y(O,{key:3,percent:m.recall,"stroke-color":{"0%":"#722ed1","100%":"#eb2f96"},size:"small"},null,8,["percent"])):h("",!0),l.dataIndex==="action"?(p(),y(R,{key:4,size:2},{default:n(()=>[a(_,{type:"link",onClick:B=>e.showDetailModal(m)},{default:n(()=>[...t[9]||(t[9]=[o("详情",-1)])]),_:1},8,["onClick"]),a(M,{title:"确定要删除这条记录吗？",onConfirm:B=>e.handleDelete(m.id),okText:"确定",cancelText:"取消"},{default:n(()=>[a(_,{type:"link",danger:""},{default:n(()=>[...t[10]||(t[10]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source"]),C("div",de,[a(x,{current:e.pagination.current,"onUpdate:current":t[3]||(t[3]=l=>e.pagination.current=l),total:e.pagination.total,"show-total":l=>`共 ${l} 条数据`,onChange:e.onPaginationChange},null,8,["current","total","show-total","onChange"])])])]),a(H,{open:e.detailVisible,"onUpdate:open":t[4]||(t[4]=l=>e.detailVisible=l),title:"搜索分析详情",onCancel:t[5]||(t[5]=l=>e.detailVisible=!1),width:"600px",footer:null},{default:n(()=>[a(Y,{column:2,bordered:""},{default:n(()=>[a(u,{label:"用户名称"},{default:n(()=>[o(d(e.currentDetail.userName),1)]),_:1}),a(u,{label:"搜索时间"},{default:n(()=>[o(d(e.currentDetail.searchTime),1)]),_:1}),a(u,{label:"搜索关键词",span:2},{default:n(()=>[o(d(e.currentDetail.keyword),1)]),_:1}),a(u,{label:"搜索结果总数"},{default:n(()=>[o(d(e.currentDetail.totalResults),1)]),_:1}),a(u,{label:"点击位置"},{default:n(()=>[o(d(e.currentDetail.clickedPosition||"-"),1)]),_:1}),a(u,{label:"点击标题",span:2},{default:n(()=>[o(d(e.currentDetail.clickedTitle||"-"),1)]),_:1}),a(u,{label:"是否点击"},{default:n(()=>[a($,{color:e.currentDetail.clickedResult?"green":"red"},{default:n(()=>[o(d(e.currentDetail.clickedResult?"已点击":"未点击"),1)]),_:1},8,["color"])]),_:1}),a(u,{label:"准确率"},{default:n(()=>[o(d(e.currentDetail.accuracy)+"%",1)]),_:1}),a(u,{label:"精确率"},{default:n(()=>[o(d(e.currentDetail.precision)+"%",1)]),_:1}),a(u,{label:"召回率"},{default:n(()=>[o(d(e.currentDetail.recall)+"%",1)]),_:1})]),_:1})]),_:1},8,["open"])],64)}const fe=ee(le,[["render",ue],["__scopeId","data-v-0f553aa8"]]);export{fe as default};
