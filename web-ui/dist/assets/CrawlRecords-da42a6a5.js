import{d as q,G as P,S as W,R as X,p as Y,H as Z,v as ee,r as J,a as f,I as te,o as b,g as K,e as g,f as t,w as a,t as E,k as y,M as ae,b as s,h as n,c as Q,l as oe}from"./index-507fc7e9.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import{E as se}from"./ExportOutlined-63bdbe79.js";import{D as ne}from"./DatabaseOutlined-e64252e7.js";const re=q({name:"CrawlRecords",components:{ArrowLeftOutlined:P,SearchOutlined:W,ReloadOutlined:X,DeleteOutlined:Y,ExportOutlined:se,DatabaseOutlined:ne},setup(){const o=Z(),e=ee(),M=o.params.spiderId,L=o.params.spiderName||"未知爬虫",w=J({dateRange:[],status:"",dataType:"",keyword:""}),G=[{title:"抓取时间",dataIndex:"crawlTime",key:"crawlTime",width:160,sorter:!0},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:100,filters:[{text:"文章",value:"article"},{text:"图片",value:"image"},{text:"视频",value:"video"},{text:"商品",value:"product"}]},{title:"抓取状态",dataIndex:"status",key:"status",width:100,filters:[{text:"成功",value:"success"},{text:"失败",value:"failed"},{text:"部分成功",value:"partial"}]},{title:"抓取数量",dataIndex:"dataCount",key:"dataCount",width:100,sorter:!0},{title:"耗时(秒)",dataIndex:"duration",key:"duration",width:80,sorter:!0},{title:"起始URL",dataIndex:"startUrl",key:"startUrl",width:200,ellipsis:!0,customCell:()=>({style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}})},{title:"操作",key:"action",width:150,fixed:"right"}],v=f([]),i=f(!1),$=f(!1),T=f(null),x={y:"calc(100vh - 400px)"},D=f(125),p=f(856),u=f(92.5),S=f(12580),r=J({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条记录`}),z=te(()=>({...r,pageSizeOptions:["10","20","50","100"]})),I=l=>({success:"success",failed:"error",partial:"warning"})[l]||"default",F=l=>({success:"成功",failed:"失败",partial:"部分成功"})[l]||l,k=()=>{const l=["article","image","video","product"],_={article:"文章",image:"图片",video:"视频",product:"商品"},C=["success","failed","partial"],H=[];for(let h=1;h<=50;h++){const j=l[Math.floor(Math.random()*l.length)],A=C[Math.floor(Math.random()*C.length)];H.push({id:`crawl_${h}`,crawlTime:`2024-01-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")} ${String(Math.floor(Math.random()*24)).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}`,dataType:_[j],status:A,dataCount:Math.floor(Math.random()*1e3)+10,duration:Math.floor(Math.random()*300)+30,startUrl:`https://example.com/page${h}`,endUrl:`https://example.com/page${h+1}`,errorMsg:A==="failed"?"网络连接超时，无法访问目标页面":null,log:A==="partial"?"部分页面抓取成功，部分页面超时":null})}return H},c=()=>{i.value=!0,setTimeout(()=>{const l=k();v.value=l.slice((r.current-1)*r.pageSize,r.current*r.pageSize),r.total=l.length,i.value=!1},500)},U=()=>{r.current=1,c(),y.success("搜索完成")},O=()=>{w.dateRange=[],w.status="",w.dataType="",w.keyword="",r.current=1,c(),y.success("搜索条件已重置")},N=(l,_,C)=>{r.current=l.current,r.pageSize=l.pageSize,c()},B=l=>{e.push(`/view/crawl_data/${M}/${l.id}`)},V=l=>{e.push(`/view/crawl_data/${M}`)},d=l=>{const _=v.value.findIndex(C=>C.id===l.id);_>-1&&(v.value.splice(_,1),r.total--,y.success("记录删除成功"))},m=()=>{ae.confirm({title:"确认清空",content:"确定要清空所有抓取记录吗？此操作不可恢复。",onOk(){v.value=[],r.total=0,y.success("所有记录已清空")}})},R=()=>{y.info("正在导出抓取记录..."),setTimeout(()=>{y.success("抓取记录导出成功")},1e3)};return c(),{spiderName:L,searchForm:w,columns:G,recordsData:v,loading:i,showDetailModal:$,currentRecord:T,tableScroll:x,todayCount:D,weekCount:p,successRate:u,totalCount:S,paginationConfig:z,getStatusColor:I,getStatusText:F,handleSearch:U,handleReset:O,handleTableChange:N,viewDetail:B,viewData:V,deleteRecord:d,clearAllRecords:m,exportRecords:R}}}),de={class:"crawl-records-container"},ie={class:"page-header"},ue={class:"header-left"},ce={class:"page-title"},pe={class:"header-actions"},me={class:"search-area"},fe={class:"stats-area"},ve={class:"table-container"},_e={key:1,class:"data-count"};function ge(o,e,M,L,w,G){const v=s("arrow-left-outlined"),i=s("a-button"),$=s("delete-outlined"),T=s("a-popconfirm"),x=s("export-outlined"),D=s("a-range-picker"),p=s("a-form-item"),u=s("a-select-option"),S=s("a-select"),r=s("a-input"),z=s("search-outlined"),I=s("reload-outlined"),F=s("a-form"),k=s("a-statistic"),c=s("a-col"),U=s("a-row"),O=s("a-tag"),N=s("database-outlined"),B=s("a-space"),V=s("a-table");return b(),K("div",de,[g("div",ie,[g("div",ue,[t(i,{onClick:e[0]||(e[0]=d=>o.$router.back()),class:"back-btn"},{default:a(()=>[t(v),e[5]||(e[5]=n(" 返回 ",-1))]),_:1}),g("span",ce,E(o.spiderName)+" - 抓取记录",1)]),g("div",pe,[t(T,{title:"确定要清空所有抓取记录吗？",onConfirm:o.clearAllRecords,okText:"确定",cancelText:"取消"},{default:a(()=>[t(i,{danger:""},{default:a(()=>[t($),e[6]||(e[6]=n(" 清空记录 ",-1))]),_:1})]),_:1},8,["onConfirm"]),t(i,{type:"primary",onClick:o.exportRecords},{default:a(()=>[t(x),e[7]||(e[7]=n(" 导出数据 ",-1))]),_:1},8,["onClick"])])]),g("div",me,[t(F,{layout:"inline",model:o.searchForm,class:"search-form"},{default:a(()=>[t(p,{label:"抓取时间",name:"dateRange"},{default:a(()=>[t(D,{value:o.searchForm.dateRange,"onUpdate:value":e[1]||(e[1]=d=>o.searchForm.dateRange=d),class:"date-picker"},null,8,["value"])]),_:1}),t(p,{label:"抓取状态",name:"status"},{default:a(()=>[t(S,{value:o.searchForm.status,"onUpdate:value":e[2]||(e[2]=d=>o.searchForm.status=d),placeholder:"请选择状态",allowClear:"",class:"status-select"},{default:a(()=>[t(u,{value:""},{default:a(()=>[...e[8]||(e[8]=[n("全部",-1)])]),_:1}),t(u,{value:"success"},{default:a(()=>[...e[9]||(e[9]=[n("成功",-1)])]),_:1}),t(u,{value:"failed"},{default:a(()=>[...e[10]||(e[10]=[n("失败",-1)])]),_:1}),t(u,{value:"partial"},{default:a(()=>[...e[11]||(e[11]=[n("部分成功",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"数据类型",name:"dataType"},{default:a(()=>[t(S,{value:o.searchForm.dataType,"onUpdate:value":e[3]||(e[3]=d=>o.searchForm.dataType=d),placeholder:"请选择数据类型",allowClear:"",class:"type-select"},{default:a(()=>[t(u,{value:""},{default:a(()=>[...e[12]||(e[12]=[n("全部",-1)])]),_:1}),t(u,{value:"article"},{default:a(()=>[...e[13]||(e[13]=[n("文章",-1)])]),_:1}),t(u,{value:"image"},{default:a(()=>[...e[14]||(e[14]=[n("图片",-1)])]),_:1}),t(u,{value:"video"},{default:a(()=>[...e[15]||(e[15]=[n("视频",-1)])]),_:1}),t(u,{value:"product"},{default:a(()=>[...e[16]||(e[16]=[n("商品",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"关键词",name:"keyword"},{default:a(()=>[t(r,{value:o.searchForm.keyword,"onUpdate:value":e[4]||(e[4]=d=>o.searchForm.keyword=d),placeholder:"请输入关键词",allowClear:"",class:"keyword-input"},null,8,["value"])]),_:1}),t(p,null,{default:a(()=>[t(i,{type:"primary",onClick:o.handleSearch},{default:a(()=>[t(z),e[17]||(e[17]=n(" 搜索 ",-1))]),_:1},8,["onClick"])]),_:1}),t(p,null,{default:a(()=>[t(i,{onClick:o.handleReset},{default:a(()=>[t(I),e[18]||(e[18]=n(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),g("div",fe,[t(U,{gutter:16},{default:a(()=>[t(c,{span:6},{default:a(()=>[t(k,{title:"今日抓取",value:o.todayCount,suffix:"条"},null,8,["value"])]),_:1}),t(c,{span:6},{default:a(()=>[t(k,{title:"本周抓取",value:o.weekCount,suffix:"条"},null,8,["value"])]),_:1}),t(c,{span:6},{default:a(()=>[t(k,{title:"成功率",value:o.successRate,suffix:"%"},null,8,["value"])]),_:1}),t(c,{span:6},{default:a(()=>[t(k,{title:"总抓取量",value:o.totalCount,suffix:"条"},null,8,["value"])]),_:1})]),_:1})]),g("div",ve,[t(V,{columns:o.columns,"data-source":o.recordsData,pagination:o.paginationConfig,loading:o.loading,scroll:o.tableScroll,rowKey:"id",size:"middle",onChange:o.handleTableChange},{bodyCell:a(({column:d,record:m})=>[d.key==="status"?(b(),Q(O,{key:0,color:o.getStatusColor(m.status)},{default:a(()=>[n(E(o.getStatusText(m.status)),1)]),_:2},1032,["color"])):d.key==="dataCount"?(b(),K("span",_e,[t(N),n(" "+E(m.dataCount)+" 条 ",1)])):d.key==="action"?(b(),Q(B,{key:2},{default:a(()=>[t(i,{type:"link",size:"small",onClick:R=>o.viewDetail(m)},{default:a(()=>[...e[19]||(e[19]=[n(" 详情 ",-1)])]),_:1},8,["onClick"]),t(i,{type:"link",size:"small",onClick:R=>o.viewData(m)},{default:a(()=>[...e[20]||(e[20]=[n(" 查看数据 ",-1)])]),_:1},8,["onClick"]),t(T,{title:"确定要删除这条记录吗？",onConfirm:R=>o.deleteRecord(m),okText:"确定",cancelText:"取消"},{default:a(()=>[t(i,{type:"link",danger:"",size:"small"},{default:a(()=>[...e[21]||(e[21]=[n(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):oe("",!0)]),_:1},8,["columns","data-source","pagination","loading","scroll","onChange"])])])}const he=le(re,[["render",ge],["__scopeId","data-v-91670704"]]);export{he as default};
