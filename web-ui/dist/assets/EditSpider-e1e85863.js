import{d as B,G as K,p as H,P as G,N as J,H as X,v as Q,a as S,r as Y,K as Z,o as D,g as L,e as m,f as a,w as t,t as $,k as w,b as s,h as n,F as x,j as h,c as P,l as A}from"./index-c56651a2.js";import{_ as c}from"./_plugin-vue_export-helper-c27b6911.js";const ee=B({name:"EditSpider",components:{ArrowLeftOutlined:K,DeleteOutlined:H,PlusOutlined:G,EyeOutlined:J},setup(){const l=X(),e=Q(),U=S(),C=S(!1),M=S(!1),F=l.params.spiderId,T=S(""),u=Y({id:"",name:"",description:"",targetUrl:"",dataType:"",crawlMode:"single",depth:1,concurrent:5,interval:1,timeout:30,selectors:[{name:"title",type:"css",value:"h1"},{name:"content",type:"css",value:".content"}],dataClean:["trim"],storageType:"database",tableName:"",fileFormat:"json",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",headers:"",cookies:"",proxy:""}),q={name:[{required:!0,message:"请输入爬虫名称",trigger:"blur"},{min:2,max:50,message:"名称长度应在2-50个字符之间",trigger:"blur"}],description:[{required:!0,message:"请输入爬虫描述",trigger:"blur"}],targetUrl:[{required:!0,message:"请输入目标网站URL",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL地址",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}],crawlMode:[{required:!0,message:"请选择爬取模式",trigger:"change"}],depth:[{required:!0,message:"请输入爬取深度",trigger:"blur"}],concurrent:[{required:!0,message:"请输入并发数量",trigger:"blur"}],interval:[{required:!0,message:"请输入请求间隔",trigger:"blur"}],timeout:[{required:!0,message:"请输入超时时间",trigger:"blur"}],storageType:[{required:!0,message:"请选择存储方式",trigger:"change"}],tableName:[{required:!0,message:"请输入数据库表名",trigger:"blur"}]},f=()=>{setTimeout(()=>{const i={id:F,name:"新闻爬虫示例",description:"这是一个用于抓取新闻网站内容的新闻爬虫",targetUrl:"https://news.example.com",dataType:"news",crawlMode:"multi",depth:3,concurrent:10,interval:2,timeout:60,selectors:[{name:"title",type:"css",value:"h1.title"},{name:"content",type:"css",value:".article-content"},{name:"author",type:"css",value:".author-name"},{name:"publish_time",type:"css",value:".publish-date"}],dataClean:["trim","html"],storageType:"database",tableName:"news_articles",fileFormat:"json",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",headers:"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",cookies:"session_id=abc123; user_pref=zh-CN",proxy:""};Object.keys(i).forEach(g=>{u.hasOwnProperty(g)&&(u[g]=i[g])}),T.value=i.name},500)},p=()=>{u.selectors.push({name:"",type:"css",value:""})},r=i=>{u.selectors.splice(i,1)},b=async()=>{try{await U.value.validate(),C.value=!0,setTimeout(()=>{w.success("爬虫修改成功"),C.value=!1,e.push("/view/all_spider")},2e3)}catch(i){console.error("表单验证失败:",i)}},d=async()=>{try{await U.value.validateFields(["targetUrl"]),w.loading("正在测试连接...",0),setTimeout(()=>{w.destroy(),w.success("连接测试成功")},1500)}catch{w.error("请先填写目标网站URL")}},k=()=>{f(),w.success("表单已重置")},v=()=>{e.back()},N=()=>{M.value=!0};return Z(()=>{f()}),{formRef:U,formData:u,formRules:q,submitLoading:C,showPreviewModal:M,spiderName:T,addSelector:p,removeSelector:r,handleSubmit:b,handleTest:d,handleReset:k,handleCancel:v,handlePreview:N}}}),ae={class:"edit-spider-container"},te={class:"page-header"},le={class:"header-left"},oe={class:"page-title"},ne={class:"header-actions"},re={class:"form-container"},se={class:"selector-config"},ue={class:"config-preview"};function de(l,e,U,C,M,F){const T=s("arrow-left-outlined"),u=s("a-button"),q=s("eye-outlined"),f=s("a-divider"),p=s("a-input"),r=s("a-form-item"),b=s("a-textarea"),d=s("a-select-option"),k=s("a-select"),v=s("a-radio"),N=s("a-radio-group"),i=s("a-input-number"),g=s("a-col"),E=s("delete-outlined"),W=s("a-row"),_=s("plus-outlined"),R=s("a-checkbox"),j=s("a-checkbox-group"),I=s("a-space"),V=s("a-form"),z=s("a-modal");return D(),L("div",ae,[m("div",te,[m("div",le,[a(u,{onClick:e[0]||(e[0]=o=>l.$router.back()),class:"back-btn"},{default:t(()=>[a(T),e[21]||(e[21]=n(" 返回 ",-1))]),_:1}),m("span",oe,"编辑爬虫 - "+$(l.spiderName),1)]),m("div",ne,[a(u,{onClick:l.handlePreview,type:"dashed"},{default:t(()=>[a(q),e[22]||(e[22]=n(" 预览配置 ",-1))]),_:1},8,["onClick"])])]),m("div",re,[a(V,{ref:"formRef",model:l.formData,rules:l.formRules,"label-col":{span:4},"wrapper-col":{span:16},size:"large"},{default:t(()=>[a(f,{orientation:"left"},{default:t(()=>[...e[23]||(e[23]=[n("基本信息",-1)])]),_:1}),a(r,{label:"爬虫ID",name:"id"},{default:t(()=>[a(p,{value:l.formData.id,"onUpdate:value":e[1]||(e[1]=o=>l.formData.id=o),disabled:""},null,8,["value"])]),_:1}),a(r,{label:"爬虫名称",name:"name"},{default:t(()=>[a(p,{value:l.formData.name,"onUpdate:value":e[2]||(e[2]=o=>l.formData.name=o),placeholder:"请输入爬虫名称"},null,8,["value"])]),_:1}),a(r,{label:"爬虫描述",name:"description"},{default:t(()=>[a(b,{value:l.formData.description,"onUpdate:value":e[3]||(e[3]=o=>l.formData.description=o),placeholder:"请输入爬虫描述",rows:3},null,8,["value"])]),_:1}),a(r,{label:"目标网站",name:"targetUrl"},{default:t(()=>[a(p,{value:l.formData.targetUrl,"onUpdate:value":e[4]||(e[4]=o=>l.formData.targetUrl=o),placeholder:"请输入目标网站URL"},null,8,["value"])]),_:1}),a(r,{label:"数据类型",name:"dataType"},{default:t(()=>[a(k,{value:l.formData.dataType,"onUpdate:value":e[5]||(e[5]=o=>l.formData.dataType=o),placeholder:"请选择数据类型"},{default:t(()=>[a(d,{value:"article"},{default:t(()=>[...e[24]||(e[24]=[n("文章",-1)])]),_:1}),a(d,{value:"image"},{default:t(()=>[...e[25]||(e[25]=[n("图片",-1)])]),_:1}),a(d,{value:"video"},{default:t(()=>[...e[26]||(e[26]=[n("视频",-1)])]),_:1}),a(d,{value:"product"},{default:t(()=>[...e[27]||(e[27]=[n("商品",-1)])]),_:1}),a(d,{value:"news"},{default:t(()=>[...e[28]||(e[28]=[n("新闻",-1)])]),_:1}),a(d,{value:"social"},{default:t(()=>[...e[29]||(e[29]=[n("社交媒体",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{orientation:"left"},{default:t(()=>[...e[30]||(e[30]=[n("爬取配置",-1)])]),_:1}),a(r,{label:"爬取模式",name:"crawlMode"},{default:t(()=>[a(N,{value:l.formData.crawlMode,"onUpdate:value":e[6]||(e[6]=o=>l.formData.crawlMode=o)},{default:t(()=>[a(v,{value:"single"},{default:t(()=>[...e[31]||(e[31]=[n("单页面",-1)])]),_:1}),a(v,{value:"multi"},{default:t(()=>[...e[32]||(e[32]=[n("多页面",-1)])]),_:1}),a(v,{value:"recursive"},{default:t(()=>[...e[33]||(e[33]=[n("递归爬取",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(r,{label:"爬取深度",name:"depth"},{default:t(()=>[a(i,{value:l.formData.depth,"onUpdate:value":e[7]||(e[7]=o=>l.formData.depth=o),min:1,max:10},null,8,["value"]),e[34]||(e[34]=m("span",{class:"help-text"},"递归爬取时的最大深度",-1))]),_:1}),a(r,{label:"并发数量",name:"concurrent"},{default:t(()=>[a(i,{value:l.formData.concurrent,"onUpdate:value":e[8]||(e[8]=o=>l.formData.concurrent=o),min:1,max:50},null,8,["value"]),e[35]||(e[35]=m("span",{class:"help-text"},"同时进行的爬取任务数量",-1))]),_:1}),a(r,{label:"请求间隔",name:"interval"},{default:t(()=>[a(i,{value:l.formData.interval,"onUpdate:value":e[9]||(e[9]=o=>l.formData.interval=o),min:0,max:60},null,8,["value"]),e[36]||(e[36]=m("span",{class:"help-text"},"每次请求之间的间隔时间（秒）",-1))]),_:1}),a(r,{label:"超时时间",name:"timeout"},{default:t(()=>[a(i,{value:l.formData.timeout,"onUpdate:value":e[10]||(e[10]=o=>l.formData.timeout=o),min:5,max:300},null,8,["value"]),e[37]||(e[37]=m("span",{class:"help-text"},"单个请求的超时时间（秒）",-1))]),_:1}),a(f,{orientation:"left"},{default:t(()=>[...e[38]||(e[38]=[n("数据提取配置",-1)])]),_:1}),a(r,{label:"选择器配置",name:"selectors"},{default:t(()=>[m("div",se,[(D(!0),L(x,null,h(l.formData.selectors,(o,O)=>(D(),L("div",{key:O,class:"selector-item"},[a(W,{gutter:8},{default:t(()=>[a(g,{span:6},{default:t(()=>[a(p,{value:o.name,"onUpdate:value":y=>o.name=y,placeholder:"字段名称"},null,8,["value","onUpdate:value"])]),_:2},1024),a(g,{span:8},{default:t(()=>[a(k,{value:o.type,"onUpdate:value":y=>o.type=y,placeholder:"选择器类型"},{default:t(()=>[a(d,{value:"css"},{default:t(()=>[...e[39]||(e[39]=[n("CSS选择器",-1)])]),_:1}),a(d,{value:"xpath"},{default:t(()=>[...e[40]||(e[40]=[n("XPath",-1)])]),_:1}),a(d,{value:"regex"},{default:t(()=>[...e[41]||(e[41]=[n("正则表达式",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024),a(g,{span:8},{default:t(()=>[a(p,{value:o.value,"onUpdate:value":y=>o.value=y,placeholder:"选择器值"},null,8,["value","onUpdate:value"])]),_:2},1024),a(g,{span:2},{default:t(()=>[l.formData.selectors.length>1?(D(),P(u,{key:0,type:"link",danger:"",onClick:y=>l.removeSelector(O)},{default:t(()=>[a(E)]),_:1},8,["onClick"])):A("",!0)]),_:2},1024)]),_:2},1024)]))),128)),a(u,{type:"dashed",onClick:l.addSelector,style:{width:"100%"}},{default:t(()=>[a(_),e[42]||(e[42]=n(" 添加选择器 ",-1))]),_:1},8,["onClick"])])]),_:1}),a(r,{label:"数据清洗",name:"dataClean"},{default:t(()=>[a(j,{value:l.formData.dataClean,"onUpdate:value":e[11]||(e[11]=o=>l.formData.dataClean=o)},{default:t(()=>[a(R,{value:"trim"},{default:t(()=>[...e[43]||(e[43]=[n("去除空白字符",-1)])]),_:1}),a(R,{value:"html"},{default:t(()=>[...e[44]||(e[44]=[n("去除HTML标签",-1)])]),_:1}),a(R,{value:"special"},{default:t(()=>[...e[45]||(e[45]=[n("去除特殊字符",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{orientation:"left"},{default:t(()=>[...e[46]||(e[46]=[n("存储配置",-1)])]),_:1}),a(r,{label:"存储方式",name:"storageType"},{default:t(()=>[a(N,{value:l.formData.storageType,"onUpdate:value":e[12]||(e[12]=o=>l.formData.storageType=o)},{default:t(()=>[a(v,{value:"database"},{default:t(()=>[...e[47]||(e[47]=[n("数据库存储",-1)])]),_:1}),a(v,{value:"file"},{default:t(()=>[...e[48]||(e[48]=[n("文件存储",-1)])]),_:1}),a(v,{value:"api"},{default:t(()=>[...e[49]||(e[49]=[n("API接口",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l.formData.storageType==="database"?(D(),P(r,{key:0,label:"数据库表",name:"tableName"},{default:t(()=>[a(p,{value:l.formData.tableName,"onUpdate:value":e[13]||(e[13]=o=>l.formData.tableName=o),placeholder:"请输入数据库表名"},null,8,["value"])]),_:1})):A("",!0),l.formData.storageType==="file"?(D(),P(r,{key:1,label:"文件格式",name:"fileFormat"},{default:t(()=>[a(k,{value:l.formData.fileFormat,"onUpdate:value":e[14]||(e[14]=o=>l.formData.fileFormat=o),placeholder:"请选择文件格式"},{default:t(()=>[a(d,{value:"json"},{default:t(()=>[...e[50]||(e[50]=[n("JSON",-1)])]),_:1}),a(d,{value:"csv"},{default:t(()=>[...e[51]||(e[51]=[n("CSV",-1)])]),_:1}),a(d,{value:"xml"},{default:t(()=>[...e[52]||(e[52]=[n("XML",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):A("",!0),a(f,{orientation:"left"},{default:t(()=>[...e[53]||(e[53]=[n("高级配置",-1)])]),_:1}),a(r,{label:"用户代理",name:"userAgent"},{default:t(()=>[a(b,{value:l.formData.userAgent,"onUpdate:value":e[15]||(e[15]=o=>l.formData.userAgent=o),placeholder:"请输入用户代理字符串",rows:2},null,8,["value"])]),_:1}),a(r,{label:"请求头",name:"headers"},{default:t(()=>[a(b,{value:l.formData.headers,"onUpdate:value":e[16]||(e[16]=o=>l.formData.headers=o),placeholder:"请输入自定义请求头，格式：key: value",rows:3},null,8,["value"])]),_:1}),a(r,{label:"Cookie",name:"cookies"},{default:t(()=>[a(b,{value:l.formData.cookies,"onUpdate:value":e[17]||(e[17]=o=>l.formData.cookies=o),placeholder:"请输入Cookie字符串",rows:2},null,8,["value"])]),_:1}),a(r,{label:"代理设置",name:"proxy"},{default:t(()=>[a(p,{value:l.formData.proxy,"onUpdate:value":e[18]||(e[18]=o=>l.formData.proxy=o),placeholder:"请输入代理服务器地址，如：http://proxy:8080"},null,8,["value"])]),_:1}),a(r,{"wrapper-col":{span:16,offset:4}},{default:t(()=>[a(I,null,{default:t(()=>[a(u,{type:"primary",onClick:l.handleSubmit,loading:l.submitLoading},{default:t(()=>[...e[54]||(e[54]=[n(" 保存修改 ",-1)])]),_:1},8,["onClick","loading"]),a(u,{onClick:l.handleTest},{default:t(()=>[...e[55]||(e[55]=[n("测试连接",-1)])]),_:1},8,["onClick"]),a(u,{onClick:l.handleReset},{default:t(()=>[...e[56]||(e[56]=[n("重置表单",-1)])]),_:1},8,["onClick"]),a(u,{onClick:l.handleCancel},{default:t(()=>[...e[57]||(e[57]=[n("取消",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),a(z,{open:l.showPreviewModal,"onUpdate:open":e[19]||(e[19]=o=>l.showPreviewModal=o),title:"配置预览",width:"800px",onCancel:e[20]||(e[20]=o=>l.showPreviewModal=!1)},{default:t(()=>[m("pre",ue,$(JSON.stringify(l.formData,null,2)),1)]),_:1},8,["open"])])}const pe=c(ee,[["render",de],["__scopeId","data-v-ce5eec9c"]]);export{pe as default};
