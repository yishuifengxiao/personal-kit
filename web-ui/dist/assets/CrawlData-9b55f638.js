import{d as R,J as z,s as j,p as V,v as J,H as P,a as _,r as q,K as A,o as $,g as L,e as f,f as e,w as a,k as b,b as l,h as m,c as O,t as B,l as E}from"./index-c56651a2.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";const H=R({name:"CrawlData",components:{LeftOutlined:z,DownloadOutlined:j,DeleteOutlined:V},setup(){const s=J(),n=P(),x=n.params.spiderId,D=n.query.spiderName||"未知爬虫",S=_(0),T=_(0),k=_(0),i=_(0),r=_([]),g=_(!1),y=[{title:"数据ID",dataIndex:"id",key:"id",width:80},{title:"抓取时间",dataIndex:"crawlTime",key:"crawlTime",width:150,customRender:({text:t})=>d(t)},{title:"来源地址",dataIndex:"sourceUrl",key:"sourceUrl",ellipsis:!0,customCell:()=>({style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}})},{title:"数据状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:150,fixed:"right"}],w=q({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条数据`}),d=t=>t?new Date(t).toLocaleString("zh-CN"):"-",u=t=>({success:"green",failed:"red",pending:"orange",processing:"blue"})[t]||"default",p=t=>({success:"成功",failed:"失败",pending:"待处理",processing:"处理中"})[t]||t,I=()=>{s.back()},M=t=>{s.push({path:`/view/crawl_data/${x}/${t.id}`,query:{spiderName:D}})},U=t=>{const o=r.value.findIndex(C=>C.id===t.id);o>-1&&(r.value.splice(o,1),b.success("删除数据成功"),h())},v=()=>{const t=JSON.stringify(r.value,null,2),o=new Blob([t],{type:"application/json"}),C=URL.createObjectURL(o),N=document.createElement("a");N.href=C,N.download=`crawl_data_${D}_${new Date().toISOString().slice(0,10)}.json`,N.click(),URL.revokeObjectURL(C),b.success("数据导出成功")},c=()=>{r.value=[],b.success("已清空所有数据"),h()},h=async()=>{g.value=!0;try{await new Promise(o=>setTimeout(o,500));const t=[];for(let o=1;o<=50;o++)t.push({id:`data_${x}_${o}`,crawlTime:new Date(Date.now()-Math.random()*864e5*30).toISOString(),sourceUrl:`https://example.com/page${o}.html`,status:["success","failed","pending","processing"][Math.floor(Math.random()*4)],content:{title:`页面标题 ${o}`,content:`这是第 ${o} 条抓取的数据内容`,url:`https://example.com/page${o}.html`}});r.value=t,w.total=t.length,S.value=t.length,T.value=Math.floor(Math.random()*20)+5,k.value=t.filter(o=>o.status==="success").length,i.value=t.filter(o=>o.status==="failed").length}catch{b.error("加载数据失败")}finally{g.value=!1}};return A(()=>{h()}),{spiderName:D,totalData:S,todayData:T,successData:k,failedData:i,spiderDataList:r,loading:g,dataColumns:y,dataPagination:w,formatTime:d,getDataStatusColor:u,getDataStatusText:p,goBack:I,viewDataDetail:M,deleteData:U,exportData:v,clearAllData:c}}}),Q={class:"crawl-data-container"},F={class:"page-header"},G={class:"header-left"},W={class:"header-actions"},X={class:"stats-section"},Y={class:"data-table-section"},Z=["href"];function tt(s,n,x,D,S,T){const k=l("left-outlined"),i=l("a-button"),r=l("download-outlined"),g=l("delete-outlined"),y=l("a-popconfirm"),w=l("a-space"),d=l("a-statistic"),u=l("a-card"),p=l("a-col"),I=l("a-row"),M=l("a-tag"),U=l("a-table");return $(),L("div",Q,[f("div",F,[f("div",G,[e(i,{onClick:s.goBack,style:{"margin-right":"16px"}},{icon:a(()=>[e(k)]),default:a(()=>[n[0]||(n[0]=m(" 返回 ",-1))]),_:1},8,["onClick"]),n[1]||(n[1]=f("h2",{class:"page-title"},"抓取数据",-1))]),f("div",W,[e(w,null,{default:a(()=>[e(i,{type:"primary",onClick:s.exportData},{icon:a(()=>[e(r)]),default:a(()=>[n[2]||(n[2]=m(" 导出数据 ",-1))]),_:1},8,["onClick"]),e(y,{title:"确定要清空所有数据吗？",onConfirm:s.clearAllData,okText:"确定",cancelText:"取消"},{default:a(()=>[e(i,{danger:""},{icon:a(()=>[e(g)]),default:a(()=>[n[3]||(n[3]=m(" 清空数据 ",-1))]),_:1})]),_:1},8,["onConfirm"])]),_:1})])]),f("div",X,[e(I,{gutter:16},{default:a(()=>[e(p,{span:6},{default:a(()=>[e(u,null,{default:a(()=>[e(d,{title:"总数据量",value:s.totalData},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(u,null,{default:a(()=>[e(d,{title:"今日新增",value:s.todayData},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(u,null,{default:a(()=>[e(d,{title:"成功抓取",value:s.successData},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:a(()=>[e(u,null,{default:a(()=>[e(d,{title:"失败数量",value:s.failedData},null,8,["value"])]),_:1})]),_:1})]),_:1})]),f("div",Y,[e(U,{columns:s.dataColumns,"data-source":s.spiderDataList,pagination:s.dataPagination,loading:s.loading,size:"small",rowKey:"id"},{bodyCell:a(({column:v,record:c})=>[v.key==="status"?($(),O(M,{key:0,color:s.getDataStatusColor(c.status)},{default:a(()=>[m(B(s.getDataStatusText(c.status)),1)]),_:2},1032,["color"])):v.key==="sourceUrl"?($(),L("a",{key:1,href:c.sourceUrl,target:"_blank",style:{"max-width":"200px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},B(c.sourceUrl),9,Z)):v.key==="action"?($(),O(w,{key:2},{default:a(()=>[e(i,{type:"link",size:"small",onClick:h=>s.viewDataDetail(c)},{default:a(()=>[...n[4]||(n[4]=[m(" 查看详情 ",-1)])]),_:1},8,["onClick"]),e(y,{title:"确定要删除这条数据吗？",onConfirm:h=>s.deleteData(c),okText:"确定",cancelText:"取消"},{default:a(()=>[e(i,{type:"link",danger:"",size:"small"},{default:a(()=>[...n[5]||(n[5]=[m(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):E("",!0)]),_:1},8,["columns","data-source","pagination","loading"])])])}const ot=K(H,[["render",tt],["__scopeId","data-v-ee327ae3"]]);export{ot as default};
