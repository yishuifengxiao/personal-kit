import{f as s,A as F,d as W,r as b,x as X,m as Y,a as Z,D as x,S as ee,o as g,g as O,w as o,F as P,u as $,b as a,e as l,q as k,c as M,h as d,t as u}from"./index-64e3746b.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";import{U as se}from"./UserOutlined-546f8b21.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"};const re=oe;function N(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(c){return Object.getOwnPropertyDescriptor(r,c).enumerable}))),i.forEach(function(c){ne(e,c,r[c])})}return e}function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S=function(t,r){var i=N({},t,r.attrs);return s(F,N({},i,{icon:re}),null)};S.displayName="LogoutOutlined";S.inheritAttrs=!1;const ae=S;var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z"}}]},name:"vertical-right",theme:"outlined"};const ie=le;function R(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?Object(arguments[t]):{},i=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(c){return Object.getOwnPropertyDescriptor(r,c).enumerable}))),i.forEach(function(c){ue(e,c,r[c])})}return e}function ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var L=function(t,r){var i=R({},t,r.attrs);return s(F,R({},i,{icon:ie}),null)};L.displayName="VerticalRightOutlined";L.inheritAttrs=!1;const de=L;const ce=W({data(){const e=b({}),t=b({leftMenus:[],topMenus:[]}),r="knowledge_graph",i="",c="",D=Date.now();return{user:e,menu:t,selectedTopKeys:r,selectedLeftKeys:i,openKeys:c,menuKey:D,userDetailVisible:!1,userDetail:{},passwordModalVisible:!1,passwordLoading:!1,passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},passwordRules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"新密码长度至少6位",trigger:"blur"},{validator:(h,p,f)=>{p===this.passwordForm.currentPassword?f(new Error("新密码不能与当前密码相同")):f()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(h,p,f)=>{p!==this.passwordForm.newPassword?f(new Error("两次输入的密码不一致")):f()},trigger:"blur"}]}}},computed:{...X($,["currentUserId","currentRoleId","currentTopMenuId","currentLeftMenuId"]),breadcrumbName:function(){var t;return((t=this.$route.meta)==null?void 0:t.breadcrumbName)||[]},selectedTopKeysSource:{get(){return this.currentTopMenuId.length>0?[this.currentTopMenuId]:this.selectedTopKeys.length>0?[this.selectedTopKeys]:[this.menu.topMenus[0].routerName]},set(e){this.selectedTopKeys=e}},leftMenuSource:function(){return this.menu.leftMenus.map(e=>{const t={key:e.routerName,label:e.name,title:e.name};return typeof e.childrens<"u"&&e.childrens.length>0&&(t.children=e.childrens.map(r=>({key:r.routerName,label:r.name,title:r.name}))),t})},selectedLeftKeysSource:{get(){if(this.selectedLeftKeys.length>0)return[this.selectedLeftKeys];if(this.currentLeftMenuId.length>0)return[this.currentLeftMenuId];const e=this.menu.leftMenus[0];return typeof e>"u"?[]:typeof e.childrens<"u"&&e.childrens.length>0?[e.childrens[0].routerName]:[e.routerName]},set(e){this.selectedLeftKeys=e}},openKeysSource:{get(){return this.openKeys.length>0?[this.openKeys]:this.menu.leftMenus.filter(e=>typeof e.childrens<"u"&&e.childrens.length>0).map(e=>e.routerName)},set(e){this.openKeys=e}}},methods:{...Y($,["setRole","setUser","setTopMenuId","setLeftMenuId","clearUser"]),async loadUserInfo(){this.$http.request({url:"/personkit/current",method:"get"}).then(e=>{if(this.user=b(e),this.setUser(e),!(e.roles.length>1)){const t=e.roles[0];this.setRole(t)}this.findRoleMenu()}).catch(e=>console.log(e))},findRoleMenu(){return new Promise((e,t)=>{this.$http.request({url:"/personkit/sys/menu/findRoleMenu",method:"post",data:{roleId:this.currentRoleId,topMenuId:this.currentTopMenuId}}).then(r=>{this.menu=b(r),e(r)}).catch(r=>{console.log(r),t(r)})})},async onTopMenuSelect({item:e,key:t}){this.setTopMenuId(e.id),this.selectedTopKeys=Z([t]),await this.findRoleMenu(),await this.autoSelectFirstLeftMenu()},async autoSelectFirstLeftMenu(){if(this.menu.leftMenus&&this.menu.leftMenus.length>0){const e=this.menu.leftMenus[0];let t="";if(e.childrens&&e.childrens.length>0?t=e.childrens[0].routerName:t=e.routerName,t){this.selectedLeftKeys=t,this.setLeftMenuId(t);try{this.$router.resolve({name:t}).matched.length>0?await this.$router.replace({name:t}):await this.$router.replace({name:"data_source_management"})}catch{console.warn(`路由 ${t} 不存在，跳转到默认路由`),await this.$router.replace({name:"data_source_management"})}this.$forceUpdate()}}},onLeftMenuSelect({key:e}){this.selectedLeftKeys=e,this.setLeftMenuId(e),this.$router.push({name:e})},goToSearch(){const e=this.$router.resolve({name:"search"});window.open(e.href,"_blank")},exit(){this.$router.push({name:"login"})},formatDate(e){return e?new Date(e).toLocaleString("zh-CN"):"-"},getStatusName(e){return{1:"正常",2:"禁用",3:"锁定"}[e]||"未知状态"},getStatusBadge(e){return{1:"success",2:"error",3:"warning"}[e]||"default"},handleDropdownVisible(e){console.log("Dropdown open:",e)},showUserProfile(){this.userDetailVisible=!0,!this.userDetail.id&&this.user.id&&(this.userDetail={...this.user})},showPasswordModal(){this.passwordModalVisible=!0,this.resetPasswordForm()},closePasswordModal(){this.passwordModalVisible=!1,this.resetPasswordForm()},resetPasswordForm(){this.passwordForm={currentPassword:"",newPassword:"",confirmPassword:""},this.$refs.passwordFormRef&&this.$refs.passwordFormRef.clearValidate()},handlePasswordSubmit(){this.$refs.passwordFormRef.validate().then(()=>{this.passwordLoading=!0;const e={currentPassword:this.passwordForm.currentPassword,newPassword:this.passwordForm.newPassword};this.$http.request({url:"/personkit/sys/user/updatePassword",method:"post",data:e}).then(t=>{this.$message.success("密码修改成功，请重新登录"),this.closePasswordModal(),setTimeout(()=>{this.handleLogout()},1500)}).catch(t=>{console.error("修改密码失败:",t),this.$message.error(t.message||"密码修改失败")}).finally(()=>{this.passwordLoading=!1})}).catch(e=>{console.error("表单验证失败:",e)})},handleLogout(){this.$confirm({title:"确认退出",content:"确定要退出登录吗？",onOk:async()=>{try{this.clearUser(),localStorage.clear(),sessionStorage.clear(),this.$message.success("已退出登录"),setTimeout(()=>{window.location.href="/"},500)}catch(e){console.error("退出登录失败:",e),window.location.href="/"}},onCancel(){console.log("取消退出")}})}},updated(){this.loadUserInfo()},created(){this.loadUserInfo()},components:{UserOutlined:se,DownOutlined:x,VerticalRightOutlined:de,LogoutOutlined:ae,SearchOutlined:ee}}),me={class:"top-menu-container"},pe={class:"search-button-container"},fe={class:"user-info-container"},he={class:"user-nickname"},ge={class:"user-dropdown-menu"},we={class:"user-info-header"},be={class:"user-info-text"},ye={class:"user-name"},_e={class:"user-role"},ve={class:"main-container"},Oe={class:"content-wrapper"},Pe={class:"content-area"},Me={class:"user-detail-content"},Se={class:"user-detail-header"},Le={class:"user-detail-info"},De={class:"detail-nickname"},Ke={class:"detail-username"};function Ve(e,t,r,i,c,D){const h=a("a-menu-item"),p=a("a-menu"),f=a("SearchOutlined"),K=a("a-button"),w=a("UserOutlined"),y=a("a-avatar"),U=a("a-divider"),C=a("VerticalRightOutlined"),T=a("LogoutOutlined"),I=a("DownOutlined"),z=a("a-dropdown"),B=a("a-layout-header"),j=a("a-layout-sider"),q=a("a-breadcrumb-item"),A=a("a-breadcrumb"),E=a("RouterView"),H=a("a-layout"),m=a("a-descriptions-item"),G=a("a-badge"),J=a("a-descriptions"),V=a("a-modal"),_=a("a-input-password"),v=a("a-form-item"),Q=a("a-form");return g(),O(P,null,[s(H,{class:"root_view"},{default:o(()=>[s(B,{class:"header"},{default:o(()=>[t[14]||(t[14]=l("div",{class:"logo-container"},[l("div",{class:"logo"},"PersonKit")],-1)),l("div",me,[s(p,{selectedKeys:e.selectedTopKeysSource,"onUpdate:selectedKeys":t[0]||(t[0]=n=>e.selectedTopKeysSource=n),theme:"dark",mode:"horizontal",onSelect:e.onTopMenuSelect,class:"top-menu"},{default:o(()=>[(g(!0),O(P,null,k(e.menu.topMenus,n=>(g(),M(h,{key:n.routerName,id:n.id},{default:o(()=>[d(u(n.name),1)]),_:2},1032,["id"]))),128))]),_:1},8,["selectedKeys","onSelect"])]),l("div",pe,[s(K,{type:"text",class:"search-button",onClick:e.goToSearch,style:{color:"#fff",fontSize:"16px"}},{icon:o(()=>[s(f)]),default:o(()=>[t[10]||(t[10]=d(" 时光搜索 ",-1))]),_:1},8,["onClick"])]),l("div",fe,[l("span",he,u(e.user.nickname),1),s(z,{onOpenChange:e.handleDropdownVisible},{overlay:o(()=>[l("div",ge,[l("div",we,[s(y,{size:"large",class:"user-avatar"},{icon:o(()=>[s(w)]),_:1}),l("div",be,[l("div",ye,u(e.user.nickname),1),l("div",_e,u(e.user.roleName||"普通用户"),1)])]),s(U,{style:{margin:"8px 0"}}),s(p,null,{default:o(()=>[s(h,{key:"profile",onClick:e.showUserProfile},{icon:o(()=>[s(w)]),default:o(()=>[t[11]||(t[11]=d(" 基本信息 ",-1))]),_:1},8,["onClick"]),s(h,{key:"password",onClick:e.showPasswordModal},{icon:o(()=>[s(C)]),default:o(()=>[t[12]||(t[12]=d(" 修改密码 ",-1))]),_:1},8,["onClick"]),s(h,{key:"logout",onClick:e.handleLogout},{icon:o(()=>[s(T)]),default:o(()=>[t[13]||(t[13]=d(" 退出登录 ",-1))]),_:1},8,["onClick"])]),_:1})])]),default:o(()=>[s(K,{type:"text",class:"user-dropdown-trigger"},{default:o(()=>[s(y,{size:"small",class:"trigger-avatar"},{icon:o(()=>[s(w)]),_:1}),s(I,{class:"dropdown-icon"})]),_:1})]),_:1},8,["onOpenChange"])])]),_:1}),l("div",ve,[s(j,{width:"200",style:{background:"#fff"},class:"sider"},{default:o(()=>[(g(),M(p,{selectedKeys:e.selectedLeftKeysSource,"onUpdate:selectedKeys":t[1]||(t[1]=n=>e.selectedLeftKeysSource=n),openKeys:e.openKeysSource,"onUpdate:openKeys":t[2]||(t[2]=n=>e.openKeysSource=n),mode:"inline",items:e.leftMenuSource,onSelect:e.onLeftMenuSelect,style:{height:"100%",borderRight:0},inlineCollapsed:!1,tooltip:!1,key:e.menuKey},null,8,["selectedKeys","openKeys","items","onSelect"]))]),_:1}),l("div",Oe,[s(A,{style:{margin:"16px 0"}},{default:o(()=>[(g(!0),O(P,null,k(e.breadcrumbName,n=>(g(),M(q,{key:n},{default:o(()=>[d(u(n),1)]),_:2},1024))),128))]),_:1}),l("div",Pe,[s(E)])])])]),_:1}),s(V,{open:e.userDetailVisible,"onUpdate:open":t[3]||(t[3]=n=>e.userDetailVisible=n),title:"用户详情",onOk:t[4]||(t[4]=n=>e.userDetailVisible=!1),onCancel:t[5]||(t[5]=n=>e.userDetailVisible=!1),width:"600px",footer:null},{default:o(()=>[l("div",Me,[l("div",Se,[s(y,{size:"large",class:"detail-avatar"},{icon:o(()=>[s(w)]),_:1}),l("div",Le,[l("div",De,u(e.userDetail.nickname||e.user.nickname),1),l("div",Ke,u(e.userDetail.username||e.user.username),1)])]),s(J,{column:1,bordered:"",class:"user-detail-descriptions"},{default:o(()=>[s(m,{label:"用户名"},{default:o(()=>[d(u(e.userDetail.username||e.user.username||"-"),1)]),_:1}),s(m,{label:"昵称"},{default:o(()=>[d(u(e.userDetail.nickname||e.user.nickname||"-"),1)]),_:1}),s(m,{label:"邮箱"},{default:o(()=>[d(u(e.userDetail.email||e.user.email||"-"),1)]),_:1}),s(m,{label:"手机号"},{default:o(()=>[d(u(e.userDetail.phone||e.user.phone||"-"),1)]),_:1}),s(m,{label:"角色"},{default:o(()=>[d(u(e.userDetail.roleName||e.user.roleName||"普通用户"),1)]),_:1}),s(m,{label:"状态"},{default:o(()=>[s(G,{status:e.getStatusBadge(e.userDetail.status),text:e.getStatusName(e.userDetail.status)},null,8,["status","text"])]),_:1}),s(m,{label:"创建时间"},{default:o(()=>[d(u(e.formatDate(e.userDetail.createTime)),1)]),_:1}),s(m,{label:"更新时间"},{default:o(()=>[d(u(e.formatDate(e.userDetail.updateTime)),1)]),_:1})]),_:1})])]),_:1},8,["open"]),s(V,{open:e.passwordModalVisible,"onUpdate:open":t[9]||(t[9]=n=>e.passwordModalVisible=n),title:"修改密码",onOk:e.handlePasswordSubmit,onCancel:e.closePasswordModal,width:"600px",confirmLoading:e.passwordLoading},{default:o(()=>[s(Q,{ref:"passwordFormRef",model:e.passwordForm,rules:e.passwordRules,layout:"horizontal",class:"password-form",labelCol:{span:6},wrapperCol:{span:18}},{default:o(()=>[s(v,{label:"当前密码",name:"currentPassword"},{default:o(()=>[s(_,{value:e.passwordForm.currentPassword,"onUpdate:value":t[6]||(t[6]=n=>e.passwordForm.currentPassword=n),placeholder:"请输入当前密码",size:"large"},null,8,["value"])]),_:1}),s(v,{label:"新密码",name:"newPassword"},{default:o(()=>[s(_,{value:e.passwordForm.newPassword,"onUpdate:value":t[7]||(t[7]=n=>e.passwordForm.newPassword=n),placeholder:"请输入新密码",size:"large"},null,8,["value"])]),_:1}),s(v,{label:"确认新密码",name:"confirmPassword"},{default:o(()=>[s(_,{value:e.passwordForm.confirmPassword,"onUpdate:value":t[8]||(t[8]=n=>e.passwordForm.confirmPassword=n),placeholder:"请再次输入新密码",size:"large"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","onOk","onCancel","confirmLoading"])],64)}const Re=te(ce,[["render",Ve],["__scopeId","data-v-df87abe7"]]);export{Re as default};
