import{S as T,R as K,i as V,r as z,a as D,l as A,o as C,g as F,e as d,f as o,w as a,y as g,b as l,h as i,t as B,F as U,c as J,s as j,a4 as L}from"./index-64e3746b.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{S as G,R as H}from"./SaveOutlined-7b758a19.js";import{C as W}from"./ClearOutlined-273b2d1e.js";const X={name:"PermissionManagement",components:{SaveOutlined:G,RollbackOutlined:H,SearchOutlined:T,ReloadOutlined:K,ClearOutlined:W},setup(){const{proxy:S}=L(),n=V(),u=z({id:"",name:"",routerName:""}),e=z({name:"",url:""}),k=D([]),c=D([]),h=D(!1),r=z({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条权限数据`,onChange:(t,_)=>{r.current=t,r.pageSize=_,p()}}),x=[{title:"资源路径",dataIndex:"url",key:"url",align:"center"},{title:"请求方法",dataIndex:"httpMethod",key:"httpMethod",align:"center"},{title:"模块名称",dataIndex:"module",key:"module",ellipsis:!0,align:"center"},{title:"资源名称",dataIndex:"name",key:"name",ellipsis:!0,align:"center"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0,align:"center"},{title:"选中状态",dataIndex:"selectionStatus",key:"selectionStatus",width:100}],m=()=>{try{const t=JSON.parse(sessionStorage.getItem("current_menu_for_permission")||"{}");t.id?(u.id=t.id,u.name=t.name,u.routerName=t.routerName):(g.error("未获取到菜单信息，请返回重试"),s())}catch(t){console.error("初始化菜单信息失败:",t),g.error("菜单信息解析失败"),s()}},p=async()=>{h.value=!0;try{const t=await S.$http.request({url:"/personkit/sys/permission/page",method:"post",data:{query:e,page:r.current,size:r.pageSize}});k.value=t.data||[],r.total=t.total||0,await y()}catch(t){console.error("加载权限列表失败:",t),g.error("加载权限列表失败"),k.value=[{id:1,name:"用户管理-查看",code:"user:view",description:"查看用户列表权限",status:1,createTime:new Date().toISOString()},{id:2,name:"用户管理-编辑",code:"user:edit",description:"编辑用户信息权限",status:1,createTime:new Date().toISOString()}],r.total=2}finally{h.value=!1}},y=async()=>{if(!u.id){console.warn("菜单ID为空，无法查询关联权限");return}try{const t=await S.$http.request({url:"/personkit/sys/menu/permission",method:"get",params:{menuId:u.id}});c.value=t}catch(t){console.error("查询菜单关联权限失败:",t),console.log("使用模拟数据演示关联权限功能")}},w=()=>{r.current=1,p()},f=()=>{e.name="",e.code="",e.status=void 0,r.current=1,p()},O=t=>{c.value=t},b=(t,_)=>{console.log("选择权限:",t,_)},I=(t,_,q)=>{console.log("全选权限:",t,_,q),t?c.value=_.map(E=>E.id):c.value=[]},v=t=>c.value.includes(t.id),R=t=>v(t)?"selected-permission-row":"",M=()=>{c.value=[]},P=async()=>{if(!u.id){g.error("未获取到菜单信息");return}if(c.value.length===0){g.warning("请先选择要分配的权限");return}await S.$http.request({url:"/personkit/sys/menu/updateMenuPermission",method:"post",data:{id:u.id,permissionIds:c.value}}),g.success("权限分配成功")},s=()=>{n.back()},N=t=>t?new Date(t).toLocaleDateString():"-";return A(()=>{m(),p()}),{currentMenu:u,searchForm:e,permissionData:k,selectedKeys:c,loading:h,pagination:r,columns:x,handleSearch:w,handleReset:f,onSelectionChange:O,onSelect:b,onSelectAll:I,isSelected:v,getRowClassName:R,clearSelection:M,savePermissions:P,handleBack:s,formatTime:N}}},Y={class:"page-content-wrapper"},Z={class:"main-container"},$={class:"search-area"},ee={class:"header-content"},te={class:"header-left"},ne={class:"header-actions"},oe={class:"content-min-height"},ae={class:"selection-info"},se={class:"table-container"},le={key:1},re={style:{"margin-top":"15px",float:"right"}};function ie(S,n,u,e,k,c){const h=l("a-typography-title"),r=l("a-typography-text"),x=l("SaveOutlined"),m=l("a-button"),p=l("RollbackOutlined"),y=l("a-space"),w=l("a-input"),f=l("a-form-item"),O=l("SearchOutlined"),b=l("ReloadOutlined"),I=l("a-form"),v=l("a-tag"),R=l("ClearOutlined"),M=l("a-table"),P=l("a-pagination");return C(),F("div",Y,[d("div",Z,[d("div",$,[d("div",ee,[d("div",te,[o(h,{level:4,class:"header-title"},{default:a(()=>[...n[3]||(n[3]=[i("菜单权限管理",-1)])]),_:1}),o(r,{type:"secondary",class:"header-subtitle"},{default:a(()=>[i(" 当前菜单："+B(e.currentMenu.name)+" ("+B(e.currentMenu.routerName)+") ",1)]),_:1})]),d("div",ne,[o(y,null,{default:a(()=>[o(m,{type:"primary",onClick:e.savePermissions,loading:e.loading},{icon:a(()=>[o(x)]),default:a(()=>[n[4]||(n[4]=i(" 保存权限 ",-1))]),_:1},8,["onClick","loading"]),o(m,{onClick:e.handleBack},{icon:a(()=>[o(p)]),default:a(()=>[n[5]||(n[5]=i(" 返回 ",-1))]),_:1},8,["onClick"])]),_:1})])])]),o(I,{layout:"inline",model:e.searchForm,class:"search-form"},{default:a(()=>[o(f,{label:"权限名称"},{default:a(()=>[o(w,{value:e.searchForm.name,"onUpdate:value":n[0]||(n[0]=s=>e.searchForm.name=s),placeholder:"请输入权限名称",allowClear:"",style:{width:"180px"},onPressEnter:e.handleSearch},null,8,["value","onPressEnter"])]),_:1}),o(f,{label:"资源路径"},{default:a(()=>[o(w,{value:e.searchForm.url,"onUpdate:value":n[1]||(n[1]=s=>e.searchForm.url=s),placeholder:"请输入资源路径",allowClear:"",style:{width:"180px"},onPressEnter:e.handleSearch},null,8,["value","onPressEnter"])]),_:1}),o(f,null,{default:a(()=>[o(y,null,{default:a(()=>[o(m,{type:"primary",onClick:e.handleSearch},{icon:a(()=>[o(O)]),default:a(()=>[n[6]||(n[6]=i(" 搜索 ",-1))]),_:1},8,["onClick"]),o(m,{onClick:e.handleReset},{icon:a(()=>[o(b)]),default:a(()=>[n[7]||(n[7]=i(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"]),d("div",oe,[d("div",ae,[o(y,null,{default:a(()=>[d("span",null,[n[8]||(n[8]=i("已选择 ",-1)),o(v,{color:"blue"},{default:a(()=>[i(B(e.selectedKeys.length),1)]),_:1}),n[9]||(n[9]=i(" 个权限",-1))]),o(m,{type:"link",onClick:e.clearSelection,size:"small"},{icon:a(()=>[o(R)]),default:a(()=>[n[10]||(n[10]=i(" 清空选择 ",-1))]),_:1},8,["onClick"])]),_:1})]),d("div",se,[o(M,{columns:e.columns,size:"small","data-source":e.permissionData,pagination:e.pagination,"row-selection":{selectedRowKeys:e.selectedKeys,onChange:e.onSelectionChange,onSelect:e.onSelect,onSelectAll:e.onSelectAll,checkStrictly:!0},"row-class-name":e.getRowClassName,scroll:{x:1e3,y:"calc(100vh - 380px)"},loading:e.loading,"row-key":s=>s.id,class:"permission-table"},{bodyCell:a(({column:s,record:N})=>[s.dataIndex==="selectionStatus"?(C(),F(U,{key:0},[e.isSelected(N)?(C(),J(v,{key:0,color:"blue"},{default:a(()=>[...n[11]||(n[11]=[i("已选中",-1)])]),_:1})):(C(),F("span",le,"-"))],64)):j("",!0)]),_:1},8,["columns","data-source","pagination","row-selection","row-class-name","loading","row-key"])]),d("div",re,[o(P,{current:e.pagination.current,"onUpdate:current":n[2]||(n[2]=s=>e.pagination.current=s),total:e.pagination.total,"show-total":s=>`共 ${s} 条权限数据`,"show-size-changer":"","show-quick-jumper":"",onChange:e.pagination.onChange},null,8,["current","total","show-total","onChange"])])])])])}const pe=Q(X,[["render",ie],["__scopeId","data-v-a89206f9"]]);export{pe as default};
