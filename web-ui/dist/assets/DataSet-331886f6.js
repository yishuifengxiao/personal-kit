import{c as z}from"./card_bg-c410ff89.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";import{d as w,r,a as b,b as n,o as f,g as _,f as a,w as o,k as I,E as U,p as N,e as i,n as B,t as h,l as E,h as m,F as V,j,c as A}from"./index-507fc7e9.js";import{S as J}from"./SettingOutlined-87c37ba4.js";const L=w({data(){return{isUpdate:!1}},computed:{selectOptionSource:function(){return this.selectOptions.map(e=>({value:e.id,label:e.fileName}))}},methods:{handleSearch(e){this.$http.request({url:"/personkit/data/center/file/page",data:{num:1,query:{fileName:e},size:10}}).then(t=>{this.selectOptions=r(t.data)}).catch(t=>console.log(t))},onOk(){this.$refs.formRef.validate().then(e=>{this.isUpdate?this.updateData(Object.assign(this.formState,e)):this.addDataSet(Object.assign(this.formState,e))}).catch(e=>{console.info("不通过",e)})},updateData(e){this.$http.request({url:"/personkit/data/dataSet/update",data:e}).then(t=>{this.open=!1,this.$emit("ok"),this.$msg.success("更新成功")})},addDataSet(e){const t=this;this.$http.request({url:"/personkit/data/dataSet/save",data:e}).then(l=>{t.open=!1,t.$emit("ok"),t.$msg.success("创建成功")}).catch(l=>console.log(l))},load(){this.$http.request({url:"/personkit/data/dataSet/detail",data:{id:this.formState.id}}).then(e=>{this.formState=r(e),this.open=!0}).catch(e=>console.log(e))},showDrawer(e){this.title=typeof e>"u"?"添加数据集":"编辑数据集",this.isUpdate=typeof e<"u",typeof e<"u"?(this.formState.id=e.id,console.log("-----------------------"+JSON.stringify(e)),this.load()):(this.formState=r({description:"",name:"",diskFiles:[]}),this.open=!0)}},mounted(){this.handleSearch("")},setup(){const e=b(!1);let t=b("添加数据集"),l=r({description:"",name:"",diskFiles:[]});const p=()=>{e.value=!1},g=b([]);return{open:e,onClose:p,title:t,selectOptions:g,formState:l}}});function W(e,t,l,p,g,$){const v=n("a-input"),d=n("a-form-item"),S=n("a-textarea"),c=n("a-select"),k=n("a-form"),y=n("a-modal");return f(),_("div",null,[a(y,{title:e.title,open:e.open,onOk:e.onOk,onCancel:e.onClose,okText:"确认",cancelText:"取消",width:600},{default:o(()=>[a(k,{ref:"formRef",model:e.formState,name:"basic",autocomplete:"off","label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[a(d,{label:"数据集名称",name:"name",rules:[{required:!0,message:"请输入数据集名称"}]},{default:o(()=>[a(v,{value:e.formState.name,"onUpdate:value":t[0]||(t[0]=u=>e.formState.name=u),placeholder:"请输入数据集名称",allowClear:""},null,8,["value"])]),_:1}),a(d,{label:"数据集描述",name:"description"},{default:o(()=>[a(S,{value:e.formState.description,"onUpdate:value":t[1]||(t[1]=u=>e.formState.description=u),placeholder:"请输入数据集描述",rows:3,allowClear:""},null,8,["value"])]),_:1}),a(d,{label:"选择数据源",name:"diskFiles",rules:[{required:!0,message:"请选择数据源"}]},{default:o(()=>[a(c,{allowClear:"",value:e.formState.diskFiles,"onUpdate:value":t[2]||(t[2]=u=>e.formState.diskFiles=u),"show-search":"",placeholder:"请输入关键字搜索数据源",mode:"multiple","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null,options:e.selectOptionSource,onSearch:e.handleSearch},null,8,["value","options","onSearch"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","open","onOk","onCancel"])])}const X=D(L,[["render",W]]);const G=w({data(){const e=r({name:"",dateRange:[]}),t=r({}),l=r({}),p=r({x:0,y:0});return{formState:e,card_bg_url:z,result:t,hoveredItem:l,mousePosition:p}},computed:{tableData:function(){return this.result.data},tooltipStyle:function(){return this.mousePosition?{position:"fixed",top:this.mousePosition.y+10+"px",left:this.mousePosition.x+10+"px",zIndex:9999,backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 12px",borderRadius:"4px",fontSize:"12px",maxWidth:"300px",wordBreak:"break-all",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"}:{}}},methods:{handleFinish(e){this.query()},resetForm(){this.formState.name="",this.formState.dateRange=[],this.query()},addDataSet(){this.$refs.ConfigurePopup.showDrawer()},query(){const e={name:this.formState.name};this.formState.dateRange&&this.formState.dateRange.length===2&&(e.startTime=this.formState.dateRange[0].format("YYYY-MM-DD")+" 00:00:00",e.endTime=this.formState.dateRange[1].format("YYYY-MM-DD")+" 23:59:59"),this.$http.request({url:"/personkit/data/dataSet/page",data:{num:this.result.num||1,query:e,size:10}}).then(t=>{this.result=r(t)}).catch(t=>console.log(t))},onAddOk(){this.query()},onPaginationChange(e,t){this.pagination.current=e,this.query()},doEdit(e){this.$refs.ConfigurePopup.showDrawer(e)},showDescription(e){this.hoveredItem=e,this.updateMousePosition(event)},hideDescription(){this.hoveredItem=null,this.mousePosition={x:0,y:0}},updateMousePosition(e){e&&(this.mousePosition={x:e.clientX,y:e.clientY})},formatTime(e){return e?e.replace("T"," ").substring(0,16):""},getInitials(e){return e?e.charAt(0).toUpperCase():"D"},doDelete(e){this.$http.request({url:"/personkit/data/dataSet/delete",data:{id:e.id}}).then(t=>{I.success("删除成功"),this.query()}).catch(t=>console.log(t))}},mounted(){this.query()},components:{EditOutlined:U,SettingOutlined:J,DeleteOutlined:N,ConfigurePopup:X},setup(){}}),H={class:"dataset-container"},K={class:"search-header"},Q={class:"content-area-compact"},Z={class:"card-cover-compact"},x=["src"],ee={class:"card-actions-overlay"},te=["title"],ae={class:"card-description-compact"},oe=["title"],ne={class:"card-avatar-compact"},se={class:"avatar-text-compact"},ie={class:"pagination-container-compact"};function re(e,t,l,p,g,$){const v=n("a-input"),d=n("a-form-item"),S=n("a-range-picker"),c=n("a-button"),k=n("a-form"),y=n("edit-outlined"),u=n("delete-outlined"),O=n("a-popconfirm"),q=n("a-avatar"),P=n("a-card-meta"),F=n("a-card"),Y=n("a-col"),M=n("a-row"),R=n("a-pagination"),T=n("ConfigurePopup");return f(),_("div",H,[i("div",K,[a(k,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish,class:"search-form"},{default:o(()=>[a(d,{label:"名称",name:"name"},{default:o(()=>[a(v,{value:e.formState.name,"onUpdate:value":t[0]||(t[0]=s=>e.formState.name=s),placeholder:"请输入数据集名称",allowClear:"",class:"search-input"},null,8,["value"])]),_:1}),a(d,{label:"创建时间",name:"dateRange"},{default:o(()=>[a(S,{value:e.formState.dateRange,"onUpdate:value":t[1]||(t[1]=s=>e.formState.dateRange=s),allowClear:"",placeholder:["开始时间","结束时间"],format:"YYYY-MM-DD",class:"date-range-input"},null,8,["value"])]),_:1}),a(d,null,{default:o(()=>[a(c,{type:"primary","html-type":"submit",class:"search-btn"},{default:o(()=>[...t[3]||(t[3]=[m(" 搜索 ",-1)])]),_:1})]),_:1}),a(d,null,{default:o(()=>[a(c,{onClick:e.resetForm,class:"reset-btn"},{default:o(()=>[...t[4]||(t[4]=[m(" 重置 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish"]),a(c,{type:"primary",onClick:e.addDataSet,class:"add-btn-float"},{default:o(()=>[...t[5]||(t[5]=[m(" 添加数据集 ",-1)])]),_:1},8,["onClick"])]),i("div",Q,[a(M,{gutter:[12,12],class:"dataset-grid-compact"},{default:o(()=>[(f(!0),_(V,null,j(e.tableData,s=>(f(),A(Y,{xs:24,sm:12,md:8,lg:6,xl:4,key:s.id},{default:o(()=>[a(F,{hoverable:"",class:"dataset-card-compact",onMouseenter:C=>e.showDescription(s,C),onMouseleave:e.hideDescription},{cover:o(()=>[i("div",Z,[i("img",{alt:"数据集封面",src:e.card_bg_url,class:"cover-image-compact"},null,8,x),i("div",ee,[a(c,{type:"primary",size:"small",onClick:C=>e.doEdit(s),class:"overlay-btn"},{default:o(()=>[a(y),t[6]||(t[6]=m(" 编辑 ",-1))]),_:1},8,["onClick"]),a(O,{title:"确定要删除这个数据集吗？",onConfirm:C=>e.doDelete(s),okText:"确定",cancelText:"取消"},{default:o(()=>[a(c,{type:"primary",danger:"",size:"small",class:"overlay-btn"},{default:o(()=>[a(u),t[7]||(t[7]=m(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])])])]),default:o(()=>[a(P,{class:"card-meta-compact"},{title:o(()=>[i("div",{class:"card-title-compact",title:s.name},h(s.name),9,te)]),description:o(()=>[i("div",ae,[i("div",{class:"create-time-compact",title:s.description},h(e.formatTime(s.createTime)),9,oe)])]),avatar:o(()=>[i("div",ne,[a(q,{size:24,class:"avatar-icon-compact"},{default:o(()=>[i("span",se,h(e.getInitials(s.name)),1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onMouseenter","onMouseleave"])]),_:2},1024))),128))]),_:1})]),i("div",ie,[a(R,{current:e.result.num,"onUpdate:current":t[2]||(t[2]=s=>e.result.num=s),total:e.result.total,"show-total":s=>`共 ${s} 条数据`,onChange:e.onPaginationChange,size:"small",class:"pagination-compact"},null,8,["current","total","show-total","onChange"])]),a(T,{ref:"ConfigurePopup",onOk:e.onAddOk},null,8,["onOk"]),e.hoveredItem&&e.hoveredItem.description?(f(),_("div",{key:0,class:"description-tooltip",style:B(e.tooltipStyle)},h(e.hoveredItem.description),5)):E("",!0)])}const pe=D(G,[["render",re],["__scopeId","data-v-c55d522c"]]);export{pe as default};
