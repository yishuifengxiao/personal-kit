import{S as V,R as A,L as J,r as q,a as B,z as T,o as g,g as E,e as u,f as n,w as o,k as S,b as r,h as i,t as v,c as D,l as K,F as U,N as L}from"./index-34def72e.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{S as j,R as G,C as H}from"./SaveOutlined-e74917cb.js";const W={name:"MenuManagement",components:{SaveOutlined:j,RollbackOutlined:G,SearchOutlined:V,ReloadOutlined:A,ClearOutlined:H},setup(){const{proxy:h}=L(),a=J(),l=q({id:"",name:"",description:"",stat:1}),t=q({name:"",routerName:""}),R=B([]),m=B([]),_=B(!1),c=q({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条菜单数据`,onChange:(e,s)=>{c.current=e,c.pageSize=s,y()}}),x=[{title:"菜单名称",dataIndex:"name",key:"name",align:"center"},{title:"路由名称",dataIndex:"routerName",key:"routerName",align:"center"},{title:"父级菜单",dataIndex:"parentName",key:"parentName",align:"center"},{title:"菜单位置",dataIndex:"typeName",key:"typeName",align:"center"},{title:"是否显示",dataIndex:"isShow",key:"isShow",align:"center",width:80},{title:"描述",dataIndex:"description",key:"description",align:"center"},{title:"选择状态",dataIndex:"selectionStatus",key:"selectionStatus",align:"center",width:100}],b=()=>{const e=sessionStorage.getItem("current_role_for_menu");if(e){const s=JSON.parse(e);l.id=s.id,l.name=s.name,l.description=s.description,l.stat=s.stat||1}else{const s=a.currentRoute.value;s.query.roleId&&(l.id=s.query.roleId,p())}},p=async()=>{if(l.id)try{const e=await h.$http.request({url:"/personkit/sys/role/detail",data:{roleId:l.id}});e.code===200&&e.data&&(l.name=e.data.name,l.description=e.data.description,l.stat=e.data.stat||1)}catch(e){console.error("加载角色详情失败:",e)}},y=async()=>{_.value=!0;try{const e=await h.$http.request({url:"/personkit/sys/menu/page",data:{num:c.current,query:t,size:c.pageSize}});R.value=e.data||[],c.total=e.total||0,await f()}catch(e){console.error("加载菜单列表失败:",e),S.error("加载菜单列表失败")}finally{_.value=!1}},f=async()=>{if(l.id)try{const e=await h.$http.request({url:"/personkit/sys/role/menu",data:{id:l.id}});m.value=e||[]}catch(e){console.error("加载角色菜单失败:",e)}},N=async()=>{if(!l.id){S.warning("请先选择角色");return}if(l.stat===0){S.warning("当前角色已禁用，无法保存菜单配置");return}_.value=!0;try{const e=await h.$http.request({url:"/personkit/sys/role/updateMenu",method:"post",data:{id:l.id,menus:m.value.map(s=>({id:s}))}});S.success("菜单配置保存成功")}catch(e){console.error("保存菜单配置失败:",e),S.error("保存菜单配置失败")}finally{_.value=!1}},w=e=>{m.value=e},k=(e,s)=>{console.log("选择菜单:",e,s)},I=(e,s,P)=>{console.log("全选菜单:",e,s,P)},C=e=>m.value.includes(e.id),O=e=>C(e)?"selected-row":"",M=()=>{c.current=1,y()},z=()=>{t.name="",t.routerName="",c.current=1,y()},F=()=>{m.value=[]},d=()=>{a.back()};return T(()=>{b(),y()}),{currentRole:l,searchForm:t,menuData:R,selectedKeys:m,loading:_,pagination:c,columns:x,loadMenus:y,saveMenus:N,onSelectionChange:w,onSelect:k,onSelectAll:I,isSelected:C,getRowClassName:O,handleSearch:M,handleReset:z,clearSelection:F,handleBack:d}}},X={class:"menu-management"},Y={class:"main-container"},Z={class:"card-header"},$={class:"header-content"},ee={class:"header-left"},te={class:"header-actions"},ae={class:"search-area"},ne={class:"selection-info"},oe={class:"table-container"},le={key:1};function re(h,a,l,t,R,m){const _=r("a-typography-title"),c=r("a-tag"),x=r("a-typography-text"),b=r("SaveOutlined"),p=r("a-button"),y=r("RollbackOutlined"),f=r("a-space"),N=r("a-alert"),w=r("a-input"),k=r("a-form-item"),I=r("SearchOutlined"),C=r("ReloadOutlined"),O=r("a-form"),M=r("ClearOutlined"),z=r("a-table"),F=r("a-card");return g(),E("div",X,[u("div",Y,[n(F,{class:"menu-card",bordered:!1},{default:o(()=>[u("div",Z,[u("div",$,[u("div",ee,[n(_,{level:4,class:"header-title"},{default:o(()=>[...a[2]||(a[2]=[i("角色菜单配置",-1)])]),_:1}),n(x,{type:"secondary",class:"header-subtitle"},{default:o(()=>[i(" 当前角色："+v(t.currentRole.name)+" ("+v(t.currentRole.description)+") ",1),n(c,{color:t.currentRole.stat===1?"green":"red",style:{"margin-left":"8px"}},{default:o(()=>[i(v(t.currentRole.stat===1?"启用":"禁用"),1)]),_:1},8,["color"])]),_:1})]),u("div",te,[n(f,null,{default:o(()=>[n(p,{type:"primary",onClick:t.saveMenus,loading:t.loading,disabled:t.currentRole.stat===0},{icon:o(()=>[n(b)]),default:o(()=>[a[3]||(a[3]=i(" 保存菜单 ",-1))]),_:1},8,["onClick","loading","disabled"]),n(p,{onClick:t.handleBack},{icon:o(()=>[n(y)]),default:o(()=>[a[4]||(a[4]=i(" 返回 ",-1))]),_:1},8,["onClick"])]),_:1})])])]),t.currentRole.stat===0?(g(),D(N,{key:0,message:"当前角色已禁用，无法保存菜单配置",type:"warning","show-icon":"",style:{"margin-bottom":"16px"}})):K("",!0),u("div",ae,[n(O,{layout:"inline",model:t.searchForm,class:"search-form"},{default:o(()=>[n(k,{label:"菜单名称"},{default:o(()=>[n(w,{value:t.searchForm.name,"onUpdate:value":a[0]||(a[0]=d=>t.searchForm.name=d),placeholder:"请输入菜单名称",allowClear:"",style:{width:"180px"},onPressEnter:t.handleSearch},null,8,["value","onPressEnter"])]),_:1}),n(k,{label:"路由名称"},{default:o(()=>[n(w,{value:t.searchForm.routerName,"onUpdate:value":a[1]||(a[1]=d=>t.searchForm.routerName=d),placeholder:"请输入路由名称",allowClear:"",style:{width:"180px"},onPressEnter:t.handleSearch},null,8,["value","onPressEnter"])]),_:1}),n(k,null,{default:o(()=>[n(f,null,{default:o(()=>[n(p,{type:"primary",onClick:t.handleSearch},{icon:o(()=>[n(I)]),default:o(()=>[a[5]||(a[5]=i(" 搜索 ",-1))]),_:1},8,["onClick"]),n(p,{onClick:t.handleReset},{icon:o(()=>[n(C)]),default:o(()=>[a[6]||(a[6]=i(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",ne,[n(f,null,{default:o(()=>[u("span",null,[a[7]||(a[7]=i("已选择 ",-1)),n(c,{color:"blue"},{default:o(()=>[i(v(t.selectedKeys.length),1)]),_:1}),a[8]||(a[8]=i(" 个菜单",-1))]),n(p,{type:"link",onClick:t.clearSelection,size:"small"},{icon:o(()=>[n(M)]),default:o(()=>[a[9]||(a[9]=i(" 清空选择 ",-1))]),_:1},8,["onClick"])]),_:1})]),u("div",oe,[n(z,{columns:t.columns,size:"small","data-source":t.menuData,pagination:t.pagination,"row-selection":{selectedRowKeys:t.selectedKeys,onChange:t.onSelectionChange,onSelect:t.onSelect,onSelectAll:t.onSelectAll,checkStrictly:!0},"row-class-name":t.getRowClassName,scroll:{x:1e3,y:"calc(100vh - 380px)"},loading:t.loading,"row-key":d=>d.id,class:"menu-table"},{bodyCell:o(({column:d,record:e})=>[d.dataIndex==="selectionStatus"?(g(),E(U,{key:0},[t.isSelected(e)?(g(),D(c,{key:0,color:"blue"},{default:o(()=>[...a[10]||(a[10]=[i("已选中",-1)])]),_:1})):(g(),E("span",le,"-"))],64)):d.dataIndex==="isShow"?(g(),D(c,{key:1,color:e.isShow===1?"green":"red"},{default:o(()=>[i(v(e.isShow===1?"显示":"隐藏"),1)]),_:2},1032,["color"])):K("",!0)]),_:1},8,["columns","data-source","pagination","row-selection","row-class-name","loading","row-key"])])]),_:1})])])}const de=Q(W,[["render",re],["__scopeId","data-v-8b6ccfed"]]);export{de as default};
