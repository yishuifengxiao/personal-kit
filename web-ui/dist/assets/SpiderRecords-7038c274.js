import{d as V,G as W,S as K,R as E,p as G,H,v as J,r as B,a as D,I as L,o as k,g as P,e as v,f as t,w as a,t as p,k as z,M as Q,b as l,h as n,c as C,l as I}from"./index-c56651a2.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";const q=V({name:"SpiderRecords",components:{ArrowLeftOutlined:W,SearchOutlined:K,ReloadOutlined:E,DeleteOutlined:G},setup(){const o=H();J(),o.params.spiderId;const e=o.params.spiderName||"未知爬虫",h=B({dateRange:[],operator:"",action:""}),O=[{title:"操作时间",dataIndex:"time",key:"time",width:160,sorter:!0},{title:"操作人",dataIndex:"operator",key:"operator",width:120,filters:[{text:"admin",value:"admin"},{text:"user1",value:"user1"}]},{title:"操作类型",dataIndex:"action",key:"action",width:100,filters:[{text:"启动",value:"start"},{text:"停止",value:"stop"},{text:"暂停",value:"pause"},{text:"编辑",value:"edit"},{text:"删除",value:"delete"}]},{title:"操作内容",dataIndex:"content",key:"content",ellipsis:!0},{title:"操作结果",dataIndex:"result",key:"result",width:80},{title:"操作",key:"action",width:120,fixed:"right"}],g=D([]),b=D(!1),M=D(!1),m=D(null),d=B({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:r=>`共 ${r} 条记录`}),w=L(()=>({...d,pageSizeOptions:["10","20","50","100"]})),T=()=>{const r=["start","stop","pause","edit","delete"],f={start:"启动爬虫",stop:"停止爬虫",pause:"暂停爬虫",edit:"编辑爬虫配置",delete:"删除爬虫"},i=["admin","user1","user2"],$=[];for(let R=1;R<=50;R++){const s=r[Math.floor(Math.random()*r.length)],_=i[Math.floor(Math.random()*i.length)];$.push({id:`record_${R}`,time:`2024-01-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")} ${String(Math.floor(Math.random()*24)).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}`,operator:_,action:s,content:`${f[s]} - ${_}`,result:Math.random()>.1?"成功":"失败",ip:`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"})}return $},c=()=>{b.value=!0,setTimeout(()=>{const r=T();g.value=r.slice((d.current-1)*d.pageSize,d.current*d.pageSize),d.total=r.length,b.value=!1},500)},u=()=>{d.current=1,c(),z.success("搜索完成")},y=()=>{h.dateRange=[],h.operator="",h.action="",d.current=1,c(),z.success("搜索条件已重置")},F=(r,f,i)=>{d.current=r.current,d.pageSize=r.pageSize,c()},N=r=>{m.value=r,M.value=!0},A=r=>{const f=g.value.findIndex(i=>i.id===r.id);f>-1&&(g.value.splice(f,1),d.total--,z.success("记录删除成功"))},S=()=>{Q.confirm({title:"确认清空",content:"确定要清空所有操作记录吗？此操作不可恢复。",onOk(){g.value=[],d.total=0,z.success("所有记录已清空")}})};return c(),{spiderName:e,searchForm:h,columns:O,recordsData:g,loading:b,showDetailModal:M,currentRecord:m,paginationConfig:w,handleSearch:u,handleReset:y,handleTableChange:F,viewDetail:N,deleteRecord:A,clearAllRecords:S}}}),X={class:"spider-records-container"},Y={class:"page-header"},Z={class:"header-left"},x={class:"page-title"},ee={class:"header-actions"},te={class:"search-area"},ae={class:"table-container"},oe={class:"user-agent"};function ne(o,e,h,O,g,b){const M=l("arrow-left-outlined"),m=l("a-button"),d=l("delete-outlined"),w=l("a-popconfirm"),T=l("a-range-picker"),c=l("a-form-item"),u=l("a-select-option"),y=l("a-select"),F=l("search-outlined"),N=l("reload-outlined"),A=l("a-form"),S=l("a-tag"),r=l("a-space"),f=l("a-table"),i=l("a-descriptions-item"),$=l("a-descriptions"),R=l("a-modal");return k(),P("div",X,[v("div",Y,[v("div",Z,[t(m,{onClick:e[0]||(e[0]=s=>o.$router.back()),class:"back-btn"},{default:a(()=>[t(M),e[6]||(e[6]=n(" 返回 ",-1))]),_:1}),v("span",x,p(o.spiderName)+" - 操作记录",1)]),v("div",ee,[t(w,{title:"确定要清空所有操作记录吗？",onConfirm:o.clearAllRecords,okText:"确定",cancelText:"取消"},{default:a(()=>[t(m,{danger:""},{default:a(()=>[t(d),e[7]||(e[7]=n(" 清空记录 ",-1))]),_:1})]),_:1},8,["onConfirm"])])]),v("div",te,[t(A,{layout:"inline",model:o.searchForm,class:"search-form"},{default:a(()=>[t(c,{label:"操作时间",name:"dateRange"},{default:a(()=>[t(T,{value:o.searchForm.dateRange,"onUpdate:value":e[1]||(e[1]=s=>o.searchForm.dateRange=s),class:"date-picker"},null,8,["value"])]),_:1}),t(c,{label:"操作人",name:"operator"},{default:a(()=>[t(y,{value:o.searchForm.operator,"onUpdate:value":e[2]||(e[2]=s=>o.searchForm.operator=s),placeholder:"请选择操作人",allowClear:"",class:"operator-select"},{default:a(()=>[t(u,{value:""},{default:a(()=>[...e[8]||(e[8]=[n("全部",-1)])]),_:1}),t(u,{value:"admin"},{default:a(()=>[...e[9]||(e[9]=[n("admin",-1)])]),_:1}),t(u,{value:"user1"},{default:a(()=>[...e[10]||(e[10]=[n("user1",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(c,{label:"操作类型",name:"action"},{default:a(()=>[t(y,{value:o.searchForm.action,"onUpdate:value":e[3]||(e[3]=s=>o.searchForm.action=s),placeholder:"请选择操作类型",allowClear:"",class:"action-select"},{default:a(()=>[t(u,{value:""},{default:a(()=>[...e[11]||(e[11]=[n("全部",-1)])]),_:1}),t(u,{value:"start"},{default:a(()=>[...e[12]||(e[12]=[n("启动",-1)])]),_:1}),t(u,{value:"stop"},{default:a(()=>[...e[13]||(e[13]=[n("停止",-1)])]),_:1}),t(u,{value:"pause"},{default:a(()=>[...e[14]||(e[14]=[n("暂停",-1)])]),_:1}),t(u,{value:"edit"},{default:a(()=>[...e[15]||(e[15]=[n("编辑",-1)])]),_:1}),t(u,{value:"delete"},{default:a(()=>[...e[16]||(e[16]=[n("删除",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(c,null,{default:a(()=>[t(m,{type:"primary",onClick:o.handleSearch},{default:a(()=>[t(F),e[17]||(e[17]=n(" 搜索 ",-1))]),_:1},8,["onClick"])]),_:1}),t(c,null,{default:a(()=>[t(m,{onClick:o.handleReset},{default:a(()=>[t(N),e[18]||(e[18]=n(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),v("div",ae,[t(f,{columns:o.columns,"data-source":o.recordsData,pagination:o.paginationConfig,loading:o.loading,rowKey:"id",size:"middle",onChange:o.handleTableChange},{bodyCell:a(({column:s,record:_})=>[s.key==="result"?(k(),C(S,{key:0,color:_.result==="成功"?"success":"error"},{default:a(()=>[n(p(_.result),1)]),_:2},1032,["color"])):s.key==="action"?(k(),C(r,{key:1},{default:a(()=>[t(m,{type:"link",size:"small",onClick:U=>o.viewDetail(_)},{default:a(()=>[...e[19]||(e[19]=[n(" 详情 ",-1)])]),_:1},8,["onClick"]),t(w,{title:"确定要删除这条记录吗？",onConfirm:U=>o.deleteRecord(_),okText:"确定",cancelText:"取消"},{default:a(()=>[t(m,{type:"link",danger:"",size:"small"},{default:a(()=>[...e[20]||(e[20]=[n(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):I("",!0)]),_:1},8,["columns","data-source","pagination","loading","onChange"])]),t(R,{open:o.showDetailModal,"onUpdate:open":e[4]||(e[4]=s=>o.showDetailModal=s),title:"操作详情",width:"600px",onCancel:e[5]||(e[5]=s=>o.showDetailModal=!1)},{default:a(()=>[o.currentRecord?(k(),C($,{key:0,column:1,size:"small",bordered:""},{default:a(()=>[t(i,{label:"记录ID"},{default:a(()=>[n(p(o.currentRecord.id),1)]),_:1}),t(i,{label:"操作时间"},{default:a(()=>[n(p(o.currentRecord.time),1)]),_:1}),t(i,{label:"操作人"},{default:a(()=>[n(p(o.currentRecord.operator),1)]),_:1}),t(i,{label:"操作类型"},{default:a(()=>[n(p(o.currentRecord.action),1)]),_:1}),t(i,{label:"操作内容"},{default:a(()=>[n(p(o.currentRecord.content),1)]),_:1}),t(i,{label:"操作结果"},{default:a(()=>[t(S,{color:o.currentRecord.result==="成功"?"success":"error"},{default:a(()=>[n(p(o.currentRecord.result),1)]),_:1},8,["color"])]),_:1}),o.currentRecord.ip?(k(),C(i,{key:0,label:"IP地址"},{default:a(()=>[n(p(o.currentRecord.ip),1)]),_:1})):I("",!0),o.currentRecord.userAgent?(k(),C(i,{key:1,label:"用户代理"},{default:a(()=>[v("div",oe,p(o.currentRecord.userAgent),1)]),_:1})):I("",!0)]),_:1})):I("",!0)]),_:1},8,["open"])])}const se=j(q,[["render",ne],["__scopeId","data-v-d16a6ce5"]]);export{se as default};
