import{d as V,r as F,a as p,i as x,o as m,g as v,e as $,f as a,w as n,u as D,b as r,h as i,F as L,c as k,t as M,j as O,l as H}from"./index-507fc7e9.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import{U as A}from"./UserOutlined-a370b352.js";const j=V({data(){const e=F({}),t=F([]),o=F([]),d=p([]),h=p(400),I=p(!1),b=p(!1),f=p(null),c=p([]),C=p([]),_=p(!1),N=p(""),q=p({checkStrictly:!1,onChange:(l,g)=>{console.log(`selectedRowKeys: ${l}`,"selectedRows: ",g)},onSelect:(l,g,S)=>{console.log(l,g,S)},onSelectAll:(l,g,S)=>{console.log(l,g,S)}}),E=p({expandedRowKeys:d.value,onExpand:(l,g)=>{l?d.value=[g.id]:d.value=[]},rowExpandable:l=>l.children&&l.children.length>0,expandIcon:({record:l,expanded:g,expandable:S,onExpand:z})=>(!l.children||l.children.length===0,null)}),R=F({idx:0,name:"",parentId:0,routerName:"",type:1,isShow:1,stat:1,description:""}),w=p(0);return{formState:e,data:t,roleSource:o,rowSelection:q,expandable:E,expandedRowKeys:d,tableHeight:h,modalVisible:I,isEditMode:b,currentEditId:f,menuList:c,filteredMenuList:C,menuLoading:_,searchKeyword:N,menuForm:R,menuFormRules:{idx:[{required:!0,message:"请输入序号",trigger:"blur"}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],routerName:[{required:!0,message:"请输入路由名称",trigger:"blur"}],type:[{required:!0,message:"请选择菜单位置",trigger:"change"}]},defaultFormState:{name:"",parentName:""},formRenderKey:w}},computed:{...x(D,["tokenVal"]),tableData:function(){return this.data},headers:function(){return{Authorization:"xtoken "+this.tokenVal}},uploadUrl:function(){return this.$cfg.rootUrl()+"/personkit/disk/file/import"},modalTitle:function(){return this.isEditMode?"编辑菜单":"新增菜单"}},methods:{handleFinish(){this.query()},handleReset(){Object.assign(this.formState,this.defaultFormState),this.pagination.current=1,this.query()},query(){this.$http.request({url:"/personkit/sys/menu/page",data:{num:this.pagination.current,query:this.formState,size:this.pagination.pageSize}}).then(e=>{this.pagination.current=e.num,this.pagination.total=e.total,this.data=F(this.processTreeData(e.data)),this.menuList=this.getAllMenus(e.data)}).catch(e=>console.log(e))},loadMenuList(){this.menuLoading=!0,this.$http.request({url:"/personkit/sys/menu/list",data:{name:""}}).then(e=>{this.menuList=e||[],this.filteredMenuList=e||[],this.menuLoading=!1}).catch(e=>{console.log(e),this.menuLoading=!1})},handleMenuSearch(e){this.searchKeyword=e,this.$http.request({url:"/personkit/sys/menu/list",data:{name:e}}).then(t=>{this.menuList=t||[],this.filteredMenuList=t||[],this.menuLoading=!1}).catch(t=>{console.log(t),this.menuLoading=!1})},handleMenuFocus(){this.menuList.length===0&&this.loadMenuList()},getAllMenus(e){const t=[],o=d=>{d.forEach(h=>{t.push({id:h.id,name:h.name}),h.children&&h.children.length>0&&o(h.children)})};return o(e),t},processTreeData(e){return!e||!Array.isArray(e)?[]:e.map(t=>({...t,children:t.children||[]}))},calculateTableHeight(){const e=window.innerHeight,t=120,o=60,d=40,h=e-t-o-d;this.tableHeight=Math.max(300,Math.min(600,h))},handleResize(){this.calculateTableHeight()},handleChange(e){e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?this.$msg.success(`${e.file.name} file uploaded successfully`):e.file.status==="error"&&this.$msg.error(`${e.file.name} file upload failed.`),this.query()},onPaginationChange(e,t){this.pagination.current=e,this.query()},showDetail(e){sessionStorage.setItem("current_view_file",JSON.stringify(e)),this.$router.push({name:"data_source_detail",query:{record:e.id}})},modifyPermissions(e){sessionStorage.setItem("current_menu_for_permission",JSON.stringify({id:e.id,name:e.name,routerName:e.routerName})),this.$router.push({name:"menu_permission_management",query:{menuId:e.id}})},showAddModal(){this.loadMenuList(),this.isEditMode=!1,this.currentEditId=null,this.resetMenuForm(),this.modalVisible=!0},showEditModal(e){this.loadMenuList(),this.isEditMode=!0,this.currentEditId=e.id,console.log("编辑菜单数据:",{original:e,isShow:e.isShow,isShowType:typeof e.isShow,stat:e.stat,statType:typeof e.stat});const t=Number(e.isShow)||0,o=Number(e.stat)||0;this.resetMenuForm(),this.formRenderKey+=1,Object.assign(this.menuForm,{idx:e.idx||0,name:e.name||"",parentId:e.parentId||0,routerName:e.routerName||"",type:e.type||1,isShow:t,stat:o,description:e.description||""}),this.$nextTick(()=>{console.log("表单数据回显后:",{menuForm:this.menuForm,isShow:this.menuForm.isShow,stat:this.menuForm.stat,formRenderKey:this.formRenderKey}),this.$refs.menuFormRef&&this.$refs.menuFormRef.clearValidate(["isShow","stat"])}),this.modalVisible=!0},resetMenuForm(){Object.assign(this.menuForm,{name:"",parentId:0,routerName:"",type:1,isShow:1,stat:1,description:""})},handleModalOk(){this.$refs.menuFormRef.validate().then(()=>{const e=this.isEditMode?"/personkit/sys/menu/update":"/personkit/sys/menu/save",t=this.isEditMode?{...this.menuForm,id:this.currentEditId}:this.menuForm;this.$http.request({url:e,data:t}).then(o=>{this.$msg.success(this.isEditMode?"菜单更新成功":"菜单新增成功"),this.modalVisible=!1,this.query()}).catch(o=>{console.log(o),this.$msg.error(this.isEditMode?"菜单更新失败":"菜单新增失败")})}).catch(()=>{this.$msg.warning("请完善表单信息")})},handleModalCancel(){this.modalVisible=!1,this.resetMenuForm()},handleToggleStatus(e,t){const o=t===1?"启用":"禁用";this.$confirm({title:`确认${o}菜单`,content:`确定要${o}菜单 "${e.name}" 吗？`,onOk:()=>{this.$http.request({url:"/personkit/sys/menu/update",data:{id:e.id,stat:t}}).then(d=>{this.$msg.success(`菜单${o}成功`),this.query()}).catch(d=>{console.log(d),this.$msg.error(`菜单${o}失败`)})}})},handleDelete(e){this.$confirm({title:"确认删除菜单",content:`确定要删除菜单 "${e.name}" 吗？此操作不可恢复。`,okText:"确定",cancelText:"取消",okButtonProps:{danger:!0},onOk:()=>{this.$http.request({url:"/personkit/sys/menu/delete",data:{id:e.id}}).then(t=>{this.$msg.success("菜单删除成功"),this.query()}).catch(t=>{console.log(t),this.$msg.error("菜单删除失败")})}})},getRowClassName(e){return!e.children||e.children.length===0?"leaf-node-row":""}},components:{UserOutlined:A},mounted(){this.query(),this.calculateTableHeight(),window.addEventListener("resize",this.handleResize),this.$watch("menuForm",e=>{console.log("menuForm变化:",{isShow:e.isShow,stat:e.stat,isShowType:typeof e.isShow,statType:typeof e.stat})},{deep:!0})},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},setup(){const e=[{title:"序号",dataIndex:"idx",key:"idx",align:"center",width:80},{title:"菜单名称",dataIndex:"name",key:"name",align:"center"},{title:"路由名称",dataIndex:"routerName",key:"routerName",ellipsis:!0,align:"center"},{title:"菜单位置",dataIndex:"typeName",key:"typeName",ellipsis:!0,align:"center"},{title:"是否显示",dataIndex:"isShow",key:"isShow",ellipsis:!0,align:"center"},{title:"状态",dataIndex:"stat",key:"stat",align:"center"},{title:"父级菜单",dataIndex:"parentName",key:"parentName",align:"center"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0,align:"center"},{title:"所需权限",dataIndex:"permissions",key:"permissions",ellipsis:!0,align:"center"},{title:"操作",dataIndex:"action",key:"action",width:300,align:"center",fixed:"right"}],t={current:1,total:0,pageSize:10},o=p([]),d={style:{width:"80px"}},h={span:14},I=F([{label:"需要鉴权",value:1},{label:"无需鉴权",value:0}]);return{columns:e,pagination:t,fileList:o,labelCol:d,wrapperCol:h,statusOptions:I}}}),B={class:"page-content-wrapper medium-data-table"},P={class:"search-area"},J={class:"content-min-height"},G={class:"table-container"},Q={style:{"max-width":"300px"}},W={class:"permission-urls"},X={key:1,style:{color:"#999"}},Y={style:{"margin-top":"15px",float:"right"}};function Z(e,t,o,d,h,I){const b=r("a-input"),f=r("a-form-item"),c=r("a-button"),C=r("a-space"),_=r("a-form"),N=r("a-tag"),q=r("a-tooltip"),E=r("a-table"),R=r("a-pagination"),w=r("a-select-option"),U=r("a-select"),T=r("a-input-number"),l=r("a-radio"),g=r("a-radio-group"),S=r("a-textarea"),z=r("a-modal");return m(),v("div",B,[$("div",P,[a(_,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish,"label-col":e.labelCol},{default:n(()=>[a(f,{label:"菜单名称",name:"name",class:"input"},{default:n(()=>[a(b,{allowClear:"",value:e.formState.name,"onUpdate:value":t[0]||(t[0]=s=>e.formState.name=s),placeholder:"菜单名称，模糊查询"},null,8,["value"])]),_:1}),a(f,{label:"父级菜单",name:"父级菜单",class:"input"},{default:n(()=>[a(b,{allowClear:"",value:e.formState.parentName,"onUpdate:value":t[1]||(t[1]=s=>e.formState.parentName=s),placeholder:"父级菜单名称，模糊查询"},null,8,["value"])]),_:1}),a(C,{class:"input"},{default:n(()=>[a(c,{type:"primary","html-type":"submit"},{default:n(()=>[...t[12]||(t[12]=[i(" 搜索 ",-1)])]),_:1}),a(c,{onClick:e.handleReset},{default:n(()=>[...t[13]||(t[13]=[i("重置",-1)])]),_:1},8,["onClick"]),a(c,{type:"primary",onClick:e.showAddModal},{default:n(()=>[...t[14]||(t[14]=[i("增加菜单",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish","label-col"])]),$("div",J,[$("div",G,[a(E,{columns:e.columns,"data-source":e.tableData,pagination:!1,scroll:{x:1500},size:"small",expandable:e.expandable,"row-key":s=>s.id,"row-class-name":e.getRowClassName},{bodyCell:n(({column:s,record:u})=>[s.dataIndex==="action"?(m(),v(L,{key:0},[!u.children||u.children.length===0?(m(),k(C,{key:0,size:2},{default:n(()=>[a(c,{type:"link",onClick:y=>e.showEditModal(u)},{default:n(()=>[...t[15]||(t[15]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",onClick:y=>e.modifyPermissions(u)},{default:n(()=>[...t[16]||(t[16]=[i("修改权限",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",danger:"",onClick:y=>e.handleDelete(u)},{default:n(()=>[...t[17]||(t[17]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):(m(),k(C,{key:1,size:2},{default:n(()=>[a(c,{type:"link",onClick:y=>e.showEditModal(u)},{default:n(()=>[...t[18]||(t[18]=[i("编辑",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",danger:"",onClick:y=>e.handleDelete(u)},{default:n(()=>[...t[19]||(t[19]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024))],64)):s.dataIndex==="stat"?(m(),k(N,{key:1,color:u.stat===1?"green":"red"},{default:n(()=>[i(M(u.stat===1?"启用":"禁用"),1)]),_:2},1032,["color"])):s.dataIndex==="isShow"?(m(),k(N,{key:2,color:u.isShow===1?"blue":"orange"},{default:n(()=>[i(M(u.isShow===1?"显示":"隐藏"),1)]),_:2},1032,["color"])):s.dataIndex==="permissions"?(m(),v(L,{key:3},[u.permissions&&u.permissions.length>0?(m(),k(q,{key:0,placement:"topLeft"},{title:n(()=>[$("div",Q,[(m(!0),v(L,null,O(u.permissions,(y,ee)=>(m(),v("div",{key:y.id},M(y.httpMethod)+" "+M(y.url),1))),128))])]),default:n(()=>[$("span",W,M(u.permissions.map(y=>y.url).join(", ")),1)]),_:2},1024)):(m(),v("span",X,"-"))],64)):H("",!0)]),_:1},8,["columns","data-source","expandable","row-key","row-class-name"])]),$("div",Y,[a(R,{current:e.pagination.current,"onUpdate:current":t[2]||(t[2]=s=>e.pagination.current=s),total:e.pagination.total,"show-total":s=>`共 ${s} 条数据`,onChange:e.onPaginationChange},null,8,["current","total","show-total","onChange"])])]),a(z,{open:e.modalVisible,"onUpdate:open":t[11]||(t[11]=s=>e.modalVisible=s),title:e.modalTitle,width:"600px",onOk:e.handleModalOk,onCancel:e.handleModalCancel},{default:n(()=>[(m(),k(_,{ref:"menuFormRef",model:e.menuForm,rules:e.menuFormRules,"label-col":{span:6},"wrapper-col":{span:16},key:e.formRenderKey},{default:n(()=>[a(f,{label:"菜单名称",name:"name"},{default:n(()=>[a(b,{value:e.menuForm.name,"onUpdate:value":t[3]||(t[3]=s=>e.menuForm.name=s),placeholder:"请输入菜单名称"},null,8,["value"])]),_:1}),a(f,{label:"父级菜单",name:"parentId"},{default:n(()=>[a(U,{value:e.menuForm.parentId,"onUpdate:value":t[4]||(t[4]=s=>e.menuForm.parentId=s),placeholder:"请选择父级菜单",allowClear:"","show-search":"","filter-option":!1,loading:e.menuLoading,onSearch:e.handleMenuSearch,onFocus:e.handleMenuFocus},{default:n(()=>[a(w,{value:0},{default:n(()=>[...t[20]||(t[20]=[i(" 顶级菜单 ",-1)])]),_:1}),(m(!0),v(L,null,O(e.filteredMenuList,s=>(m(),k(w,{key:s.id,value:s.id},{default:n(()=>[i(M(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading","onSearch","onFocus"])]),_:1}),a(f,{label:"路由名称",name:"routerName"},{default:n(()=>[a(b,{value:e.menuForm.routerName,"onUpdate:value":t[5]||(t[5]=s=>e.menuForm.routerName=s),placeholder:"请输入路由名称"},null,8,["value"])]),_:1}),a(f,{label:"菜单位置",name:"type"},{default:n(()=>[a(U,{value:e.menuForm.type,"onUpdate:value":t[6]||(t[6]=s=>e.menuForm.type=s),placeholder:"请选择菜单位置"},{default:n(()=>[a(w,{value:1},{default:n(()=>[...t[21]||(t[21]=[i("顶部菜单",-1)])]),_:1}),a(w,{value:2},{default:n(()=>[...t[22]||(t[22]=[i("侧边菜单",-1)])]),_:1}),a(w,{value:3},{default:n(()=>[...t[23]||(t[23]=[i("底部菜单",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"序号",name:"idx"},{default:n(()=>[a(T,{value:e.menuForm.idx,"onUpdate:value":t[7]||(t[7]=s=>e.menuForm.idx=s),placeholder:"请输入序号",min:0,precision:0,style:{width:"100%"}},null,8,["value"])]),_:1}),a(f,{label:"是否显示",name:"isShow"},{default:n(()=>[a(g,{value:e.menuForm.isShow,"onUpdate:value":t[8]||(t[8]=s=>e.menuForm.isShow=s)},{default:n(()=>[a(l,{value:1},{default:n(()=>[...t[24]||(t[24]=[i("显示",-1)])]),_:1}),a(l,{value:0},{default:n(()=>[...t[25]||(t[25]=[i("隐藏",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"状态",name:"stat"},{default:n(()=>[a(g,{value:e.menuForm.stat,"onUpdate:value":t[9]||(t[9]=s=>e.menuForm.stat=s)},{default:n(()=>[a(l,{value:1},{default:n(()=>[...t[26]||(t[26]=[i("启用",-1)])]),_:1}),a(l,{value:0},{default:n(()=>[...t[27]||(t[27]=[i("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"描述",name:"description"},{default:n(()=>[a(S,{value:e.menuForm.description,"onUpdate:value":t[10]||(t[10]=s=>e.menuForm.description=s),placeholder:"请输入菜单描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),_:1},8,["open","title","onOk","onCancel"])])}const se=K(j,[["render",Z],["__scopeId","data-v-798f00b0"]]);export{se as default};
