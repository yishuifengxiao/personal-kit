import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{P as z,R as A,S as B,D as q,y as g,o as h,g as O,e as f,f as t,w as a,b as n,h as r,c as _,t as y,s as R}from"./index-64e3746b.js";import{C as j}from"./ClearOutlined-273b2d1e.js";const G={name:"SearchSourceManagement",components:{PlusOutlined:z,ReloadOutlined:A,SearchOutlined:B,ClearOutlined:j,DownOutlined:q},data(){return{formRef:null,loading:!1,modalVisible:!1,modalLoading:!1,testModalVisible:!1,testLoading:!1,isEditMode:!1,testRecord:null,testResult:null,searchForm:{name:"",type:void 0},formData:{name:"",type:"file",config:"",description:"",status:1},formRules:{name:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],type:[{required:!0,message:"请选择数据源类型",trigger:"change"}],config:[{required:!0,message:"请输入连接配置",trigger:"blur"},{validator:this.validateJsonFormat,trigger:"blur"}]},dataSource:[],pagination:{current:1,pageSize:10,total:0}}},computed:{modalTitle(){return this.isEditMode?"编辑数据源":"新增数据源"},columns(){return[{title:"数据源名称",dataIndex:"name",key:"name",width:"20%"},{title:"数据源类型",dataIndex:"type",key:"type",width:"15%"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:"10%"},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:"15%"},{title:"操作",key:"action",width:"20%"}]}},mounted(){this.loadData()},methods:{validateJsonFormat(s,e){if(!e)return Promise.resolve();try{return JSON.parse(e),Promise.resolve()}catch{return Promise.reject("JSON格式不正确")}},validateJson(){if(this.formData.config)try{JSON.parse(this.formData.config)}catch{g.error("JSON格式不正确")}},getTypeColor(s){return{file:"blue",database:"green",api:"orange"}[s]||"default"},getTypeLabel(s){return{file:"文件",database:"数据库",api:"API接口"}[s]||s},handleFinish(){this.pagination.current=1,this.loadData()},handleReset(){this.searchForm.name="",this.searchForm.type=void 0,this.pagination.current=1,this.loadData()},onPaginationChange(s,e){this.pagination.current=s,this.pagination.pageSize=e,this.loadData()},handleTypeChange(){const s={file:'{"path": "/path/to/files", "extensions": [".txt", ".pdf", ".doc"]}',database:'{"host": "localhost", "port": 3306, "database": "search_db", "username": "root"}',api:'{"url": "https://api.example.com", "method": "GET", "headers": {}}'};this.formData.config=s[this.formData.type]||""},showAddModal(){this.isEditMode=!1,this.resetForm(),this.modalVisible=!0},showEditModal(s){this.isEditMode=!0,Object.assign(this.formData,s),this.modalVisible=!0},showTestModal(s){this.testRecord=s,this.testResult=null,this.testModalVisible=!0},resetForm(){this.formData.name="",this.formData.type="file",this.formData.config="",this.formData.description="",this.formData.status=1},handleModalOk(){this.$refs.formRef.validate().then(()=>{this.isEditMode?this.updateData():this.addData()}).catch(s=>{console.error("表单验证失败:",s)})},handleModalCancel(){this.modalVisible=!1,this.resetForm()},handleTestOk(){this.testLoading=!0,setTimeout(()=>{this.testResult={success:Math.random()>.3,message:Math.random()>.3?"连接成功":"连接失败，请检查配置"},this.testLoading=!1},1500)},handleTestCancel(){this.testModalVisible=!1,this.testRecord=null,this.testResult=null},handleOperationMenu(s,e){switch(e){case"test":this.showTestModal(s);break;case"delete":this.handleDelete(s);break}},handleDelete(s){const e=this.dataSource.findIndex(u=>u.id===s.id);e>-1&&(this.dataSource.splice(e,1),g.success("删除成功"))},loadData(){this.loading=!0,setTimeout(()=>{let e=[{id:1,name:"本地文档库",type:"file",description:"本地文档文件搜索数据源",config:'{"path": "/data/documents", "extensions": [".txt", ".pdf", ".doc", ".docx"]}',status:1,createTime:"2024-01-15 10:30:00"},{id:2,name:"知识库数据库",type:"database",description:"知识图谱数据库搜索数据源",config:'{"host": "localhost", "port": 3306, "database": "knowledge_base", "username": "root"}',status:1,createTime:"2024-01-16 14:20:00"},{id:3,name:"外部API接口",type:"api",description:"外部系统API搜索数据源",config:'{"url": "https://api.example.com/search", "method": "POST", "headers": {"Authorization": "Bearer token"}}',status:0,createTime:"2024-01-17 09:15:00"}];this.searchForm.name&&(e=e.filter(u=>u.name.toLowerCase().includes(this.searchForm.name.toLowerCase()))),this.searchForm.type&&(e=e.filter(u=>u.type===this.searchForm.type)),this.dataSource=e,this.pagination.total=e.length,this.loading=!1},500)},addData(){this.modalLoading=!0,setTimeout(()=>{const s={...this.formData,id:Date.now(),createTime:new Date().toLocaleString("zh-CN")};this.dataSource.unshift(s),this.modalVisible=!1,this.modalLoading=!1,g.success("新增成功")},1e3)},updateData(){this.modalLoading=!0,setTimeout(()=>{const s=this.dataSource.findIndex(e=>e.id===this.formData.id);s>-1&&(this.dataSource[s]={...this.formData}),this.modalVisible=!1,this.modalLoading=!1,g.success("更新成功")},1e3)}}},H={class:"page-content-wrapper"},K={class:"search-area"},Q={class:"content-min-height"},W={style:{"margin-top":"15px",float:"right"}},X={class:"test-content"},Y={key:0,class:"test-result"};function Z(s,e,u,$,o,i){const b=n("a-input"),m=n("a-form-item"),p=n("a-select-option"),v=n("a-select"),c=n("a-button"),D=n("a-space"),k=n("a-form"),S=n("a-tag"),F=n("a-badge"),C=n("a-menu-item"),L=n("a-menu"),V=n("DownOutlined"),I=n("a-dropdown"),P=n("a-table"),N=n("a-pagination"),w=n("a-textarea"),x=n("a-radio"),U=n("a-radio-group"),T=n("a-modal"),E=n("a-alert");return h(),O("div",H,[f("div",K,[t(k,{layout:"inline",name:"basic",autocomplete:"off",model:o.searchForm,onFinish:i.handleFinish},{default:a(()=>[t(m,{label:"数据源名称",name:"name",class:"input"},{default:a(()=>[t(b,{allowClear:"",value:o.searchForm.name,"onUpdate:value":e[0]||(e[0]=l=>o.searchForm.name=l),placeholder:"数据源名称，模糊查询"},null,8,["value"])]),_:1}),t(m,{label:"数据源类型",name:"type",class:"input"},{default:a(()=>[t(v,{allowClear:"",style:{width:"180px"},value:o.searchForm.type,"onUpdate:value":e[1]||(e[1]=l=>o.searchForm.type=l),placeholder:"请选择类型"},{default:a(()=>[t(p,{value:"file"},{default:a(()=>[...e[10]||(e[10]=[r("文件",-1)])]),_:1}),t(p,{value:"database"},{default:a(()=>[...e[11]||(e[11]=[r("数据库",-1)])]),_:1}),t(p,{value:"api"},{default:a(()=>[...e[12]||(e[12]=[r("API接口",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(D,null,{default:a(()=>[t(c,{type:"primary","html-type":"submit"},{default:a(()=>[...e[13]||(e[13]=[r(" 搜索 ",-1)])]),_:1}),t(c,{onClick:i.handleReset},{default:a(()=>[...e[14]||(e[14]=[r(" 重置 ",-1)])]),_:1},8,["onClick"]),t(c,{type:"primary",onClick:i.showAddModal},{default:a(()=>[...e[15]||(e[15]=[r(" 新增数据源 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish"])]),f("div",Q,[t(P,{columns:i.columns,"data-source":o.dataSource,pagination:!1,scroll:{x:1e3},size:"small"},{bodyCell:a(({column:l,record:d})=>[l.key==="type"?(h(),_(S,{key:0,color:i.getTypeColor(d.type)},{default:a(()=>[r(y(i.getTypeLabel(d.type)),1)]),_:2},1032,["color"])):l.key==="status"?(h(),_(F,{key:1,status:d.status===1?"success":"error",text:d.status===1?"启用":"禁用"},null,8,["status","text"])):l.key==="action"?(h(),_(D,{key:2,size:2},{default:a(()=>[t(c,{type:"link",size:"small",onClick:M=>i.showEditModal(d)},{default:a(()=>[...e[16]||(e[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(I,null,{overlay:a(()=>[t(L,{onClick:({key:M})=>i.handleOperationMenu(d,M)},{default:a(()=>[t(C,{key:"test"},{default:a(()=>[...e[17]||(e[17]=[r("测试连接",-1)])]),_:1}),t(C,{key:"delete",style:{color:"#ff4d4f"}},{default:a(()=>[...e[18]||(e[18]=[r("删除",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[t(c,{type:"link",size:"small"},{default:a(()=>[e[19]||(e[19]=r(" 操作 ",-1)),t(V)]),_:1})]),_:2},1024)]),_:2},1024)):R("",!0)]),_:1},8,["columns","data-source"]),f("div",W,[t(N,{current:o.pagination.current,"onUpdate:current":e[2]||(e[2]=l=>o.pagination.current=l),total:o.pagination.total,"show-total":l=>`共 ${l} 条数据`,onChange:i.onPaginationChange},null,8,["current","total","show-total","onChange"])])]),t(T,{open:o.modalVisible,"onUpdate:open":e[8]||(e[8]=l=>o.modalVisible=l),title:i.modalTitle,onOk:i.handleModalOk,onCancel:i.handleModalCancel,width:"600px"},{default:a(()=>[t(k,{ref:"formRef",model:o.formData,"label-col":{span:6},"wrapper-col":{span:16},rules:o.formRules},{default:a(()=>[t(m,{label:"数据源名称",name:"name"},{default:a(()=>[t(b,{value:o.formData.name,"onUpdate:value":e[3]||(e[3]=l=>o.formData.name=l),placeholder:"请输入数据源名称"},null,8,["value"])]),_:1}),t(m,{label:"数据源类型",name:"type"},{default:a(()=>[t(v,{value:o.formData.type,"onUpdate:value":e[4]||(e[4]=l=>o.formData.type=l),placeholder:"请选择数据源类型",onChange:i.handleTypeChange},{default:a(()=>[t(p,{value:"file"},{default:a(()=>[...e[20]||(e[20]=[r("文件",-1)])]),_:1}),t(p,{value:"database"},{default:a(()=>[...e[21]||(e[21]=[r("数据库",-1)])]),_:1}),t(p,{value:"api"},{default:a(()=>[...e[22]||(e[22]=[r("API接口",-1)])]),_:1})]),_:1},8,["value","onChange"])]),_:1}),t(m,{label:"连接配置",name:"config"},{default:a(()=>[t(w,{value:o.formData.config,"onUpdate:value":e[5]||(e[5]=l=>o.formData.config=l),placeholder:"请输入连接配置（JSON格式）",rows:4,onBlur:i.validateJson},null,8,["value","onBlur"])]),_:1}),t(m,{label:"描述",name:"description"},{default:a(()=>[t(w,{value:o.formData.description,"onUpdate:value":e[6]||(e[6]=l=>o.formData.description=l),placeholder:"请输入数据源描述",rows:3},null,8,["value"])]),_:1}),t(m,{label:"状态",name:"status"},{default:a(()=>[t(U,{value:o.formData.status,"onUpdate:value":e[7]||(e[7]=l=>o.formData.status=l)},{default:a(()=>[t(x,{value:1},{default:a(()=>[...e[23]||(e[23]=[r("启用",-1)])]),_:1}),t(x,{value:0},{default:a(()=>[...e[24]||(e[24]=[r("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","onOk","onCancel"]),t(T,{open:o.testModalVisible,"onUpdate:open":e[9]||(e[9]=l=>o.testModalVisible=l),title:"测试数据源连接",width:"400px",onOk:i.handleTestOk,onCancel:i.handleTestCancel,confirmLoading:o.testLoading},{default:a(()=>{var l,d;return[f("div",X,[f("p",null,"数据源："+y((l=o.testRecord)==null?void 0:l.name),1),f("p",null,"类型："+y(i.getTypeLabel((d=o.testRecord)==null?void 0:d.type)),1),o.testResult?(h(),O("div",Y,[t(E,{message:o.testResult.success?"连接成功":"连接失败",description:o.testResult.message,type:o.testResult.success?"success":"error","show-icon":""},null,8,["message","description","type"])])):R("",!0)])]}),_:1},8,["open","onOk","onCancel","confirmLoading"])])}const oe=J(G,[["render",Z],["__scopeId","data-v-95871ba7"]]);export{oe as default};
