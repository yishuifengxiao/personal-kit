import{d as v,r as p,i as w,k as U,a as q,o as y,g as I,e as k,f as a,w as n,u as z,b as o,h as r,c as B,l as F}from"./index-bc318887.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";import{U as L}from"./UserOutlined-3c2c78e9.js";const T=v({data(){const e=p({fileName:""}),t=p([]);return{formState:e,data:t}},computed:{...w(z,["tokenVal"]),tableData:function(){return this.data},headers:function(){return{Authorization:"xtoken "+this.tokenVal}},uploadUrl:function(){return this.$cfg.rootUrl()+"/personkit/upload/file"}},methods:{handleFinish(){this.query()},query(){this.$http.request({url:"/personkit/data/center/file/page",data:{num:this.pagination.current,query:this.formState,size:this.pagination.pageSize}}).then(e=>{this.pagination.current=e.num,this.pagination.total=e.total,this.data=p(e.data)}).catch(e=>{console.error("查询数据失败:",e),U.error("查询数据失败: "+(e.message||"未知错误"))})},handleReset(){this.formState=p({fileName:""}),this.pagination.current=1,this.query()},showUploadHistory(){this.$router.push({name:"upload_history"})},handleDelete(e){this.$confirm({title:"确认删除",content:`确定要删除文件 "${e.originalFileName}" 吗？`,okText:"确认",cancelText:"取消",onOk:()=>{e.id,this.$http.request({url:"/personkit/disk/file/deletes",method:"post",data:{ids:[e.id]}}).then(t=>{this.$message.success("删除成功"),this.query()}).catch(t=>{console.error("删除文件失败:",t),this.$message.error("删除文件失败")})}})},handleChange(e){debugger;if(e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"){const t=e.file.response;t&&t.code===500?(this.$message.error(t.msg||"文件上传失败"),console.error("文件上传失败:",t)):t&&t.code===0?this.$message.success(`${e.file.name} 文件上传成功`):this.$message.success(`${e.file.name} 文件上传成功`)}else e.file.status==="error"&&(this.$message.error(`${e.file.name} 文件上传失败`),console.error("文件上传失败:",e.file.error));this.query()},onPaginationChange(e,t){this.pagination.current=e,this.query()},showDetail(e){sessionStorage.setItem("current_view_file",JSON.stringify(e)),this.$router.push({name:"data_source_detail",query:{record:e.id}})}},components:{UserOutlined:L},mounted(){this.query()},setup(){const e=[{title:"文件名称",dataIndex:"originalFileName",key:"originalFileName",align:"center",ellipsis:!0},{title:"文件大小",dataIndex:"size",key:"size",align:"center",customRender:({text:s})=>{if(!s)return"0 B";const f=["B","KB","MB","GB"];let d=s,u=0;for(;d>=1024&&u<f.length-1;)d/=1024,u++;return`${d.toFixed(2)} ${f[u]}`}},{title:"文件类型",dataIndex:"suffix",key:"suffix",align:"center"},{title:"模式",dataIndex:"mode",key:"mode",align:"center",customRender:({text:s})=>s===0?"仅上传":s===1?"上传且解析":"未知"},{title:"创建时间",dataIndex:"createTime",key:"createTime",align:"center"},{title:"操作",dataIndex:"action",key:"action",align:"center"}],t={current:1,total:0,pageSize:10},h=q([]);return{columns:e,pagination:t,fileList:h}}}),V={style:{display:"flex","justify-content":"space-between","align-items":"center"}},R={style:{"margin-top":"15px",float:"right"}};function O(e,t,h,s,f,d){const u=o("a-input"),c=o("a-form-item"),l=o("a-button"),$=o("a-form"),_=o("a-upload"),g=o("a-space"),C=o("a-divider"),b=o("a-table"),N=o("a-pagination");return y(),I("div",null,[k("div",V,[a($,{layout:"inline",name:"basic",autocomplete:"off",model:e.formState,onFinish:e.handleFinish},{default:n(()=>[a(c,{label:"文件名",name:"fileName"},{default:n(()=>[a(u,{value:e.formState.fileName,"onUpdate:value":t[0]||(t[0]=i=>e.formState.fileName=i),placeholder:"文件名，模糊查询"},null,8,["value"])]),_:1}),a(c,null,{default:n(()=>[a(l,{type:"primary","html-type":"submit"},{default:n(()=>[...t[3]||(t[3]=[r(" 搜索 ",-1)])]),_:1})]),_:1}),a(c,null,{default:n(()=>[a(l,{onClick:e.handleReset},{default:n(()=>[...t[4]||(t[4]=[r(" 重置 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","onFinish"]),a(g,null,{default:n(()=>[a(_,{"file-list":e.fileList,"onUpdate:fileList":t[1]||(t[1]=i=>e.fileList=i),name:"file",action:e.uploadUrl,headers:e.headers,onChange:e.handleChange,showUploadList:!1},{default:n(()=>[a(l,{type:"primary"},{default:n(()=>[...t[5]||(t[5]=[r("上传文件",-1)])]),_:1})]),_:1},8,["file-list","action","headers","onChange"]),a(l,{type:"primary",onClick:e.showUploadHistory},{default:n(()=>[...t[6]||(t[6]=[r("上传历史",-1)])]),_:1},8,["onClick"])]),_:1})]),a(C,{dashed:""}),a(b,{columns:e.columns,"data-source":e.tableData,size:"small",pagination:!1},{bodyCell:n(({column:i,record:m})=>[i.dataIndex==="action"?(y(),B(g,{key:0},{default:n(()=>[a(l,{type:"link",onClick:S=>e.showDetail(m),disabled:m.stat!=2||m.actualTotalNum===0},{default:n(()=>[...t[7]||(t[7]=[r("详情",-1)])]),_:1},8,["onClick","disabled"]),a(l,{type:"link",danger:"",onClick:S=>e.handleDelete(m)},{default:n(()=>[...t[8]||(t[8]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):F("",!0)]),_:1},8,["columns","data-source"]),k("div",R,[a(N,{current:e.pagination.current,"onUpdate:current":t[2]||(t[2]=i=>e.pagination.current=i),total:e.pagination.total,"show-total":i=>`共 ${i} 条数据`,onChange:e.onPaginationChange},null,8,["current","total","show-total","onChange"])])])}const A=D(T,[["render",O]]);export{A as default};
